import{u as dn,a as nr,b as ve,j as e,F as I,I as K,B as cn,c as un,H as V,S as hn,d as xn,e as mn,r as m,f as _r,g as hr,h as j,i as C,k as De,l as jn,D as Ue,m as Ks,n as qr,o as Ar,p as kr,q as zr,s as Tr,t as Fr,v as Nr,w as Lr,x as Ir,A as Br,T as o,y as Fe,L as $e,z as sr,N as rs,M as pn,C as gn,E as fn,G as bn,J as ls,K as O,O as ge,P as Or,Q as tr,R as ke,U as Se,V as ee,W as ae,X as q,Y as A,Z as T,_ as Qe,$ as yn,a0 as vn,a1 as Cn,a2 as Z,a3 as k,a4 as ar,a5 as re,a6 as Sn,a7 as hs,a8 as Ts,a9 as Fs,aa as Ns,ab as Ls,ac as xs,ad as Is,ae as cs,af as Mr,ag as $r,ah as Wr,ai as W,aj as Vr,ak as ze,al as xe,am as Oe,an as ys,ao as me,ap as vs,aq as je,ar as Te,as as pe,at as wn,au as Je,av as ye,aw as ms,ax as js,ay as fs,az as Us,aA as Kr,aB as Ur,aC as Ye,aD as Qs,aE as ns,aF as Ee,aG as _e,aH as qe,aI as Ae,aJ as Qr,aK as Dn,aL as Rn,aM as qs,aN as As,aO as es,aP as ss,aQ as or,aR as ks,aS as zs,aT as Xe,aU as Re,aV as We,aW as ir,aX as ne,aY as xr,aZ as Pe,a_ as Ge,a$ as lr,b0 as dr,b1 as Ve,b2 as cr,b3 as Ke,b4 as ts,b5 as as,b6 as mr,b7 as bs,b8 as jr,b9 as Pn,ba as Ne,bb as Le,bc as Ie,bd as se,be as N,bf as Be,bg as z,bh as En,bi as _n,bj as pr,bk as rr,bl as Ys,bm as ie,bn as Gr,bo as qn,bp as An,bq as kn,br as zn,bs as Tn,bt as Fn,bu as Nn,bv as Ln,bw as In,bx as Bn,by as Ze,bz as Js,bA as On,bB as gr,bC as fr,bD as Mn,bE as ds,bF as $n,bG as we,bH as Wn,bI as Vn,bJ as Kn,bK as Un,bL as Qn,bM as Gn}from"./vendor-B0cAjK48.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))a(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(t){if(t.ep)return;t.ep=!0;const l=n(t);fetch(t.href,l)}})();const Hn={"/dashboard":"Dashboard","/movimentacoes":"Movimentações","/relatorios":"Relatórios Gerenciais","/clientes":"Clientes","/produtos":"Produtos","/fornecedores":"Fornecedores","/utilizadores":"Gestão de Utilizadores"},Zn=({onToggleSidebar:s,isSidebarOpen:r})=>{const{colorMode:n,toggleColorMode:a}=dn(),t=nr(),l=ve({base:!0,md:!1}),c=Hn[t.pathname]||"Caipirão 3.0";return e.jsxs(I,{as:"header",align:"center",justify:"space-between",w:"full",px:"4",bg:"transparent",borderBottomWidth:"0px",h:"14",children:[e.jsxs(I,{align:"center",children:[!l&&e.jsx(K,{"aria-label":"Toggle Sidebar",icon:r?e.jsx(cn,{}):e.jsx(un,{}),onClick:s,variant:"ghost",mr:3,fontSize:"20px"}),e.jsx(V,{as:"h1",size:"md",children:c})]}),e.jsx(hn,{}),e.jsx(K,{"aria-label":"Toggle Theme",icon:n==="light"?e.jsx(xn,{}):e.jsx(mn,{}),onClick:a,variant:"ghost"})]})},Hr=m.createContext(void 0),Yn=({children:s})=>{const[r,n]=m.useState(null),[a,t]=m.useState(!0),l=_r();m.useEffect(()=>{const i=localStorage.getItem("token");if(i)try{const x=hr(i);x.exp*1e3>Date.now()?n(x):localStorage.removeItem("token")}catch(x){console.error("Token inválido:",x),localStorage.removeItem("token")}t(!1)},[]);const c=m.useCallback(i=>{try{const x=hr(i);localStorage.setItem("token",i),n(x),l("/dashboard")}catch(x){console.error("Falha ao processar o token de login:",x)}},[l]),u=m.useCallback(()=>{n(null),localStorage.removeItem("token"),l("/login")},[l]),d={user:r,isAuthenticated:!a&&!!r,loading:a,login:c,logout:u};return e.jsx(Hr.Provider,{value:d,children:!a&&s})},Me=()=>{const s=m.useContext(Hr);if(s===void 0)throw new Error("useAuth deve ser usado dentro de um AuthProvider");return s},He=({icon:s,to:r,children:n})=>{const t=nr().pathname===r,l=j("teal.400","teal.600"),c="white",u=j("gray.600","gray.300"),d=j("gray.100","gray.700");return e.jsxs($e,{as:rs,to:r,p:3,display:"flex",alignItems:"center",borderRadius:"md",bg:t?l:"transparent",color:t?c:u,fontWeight:t?"bold":"normal",_hover:{textDecoration:"none",bg:t?l:d},role:"group",children:[e.jsx(De,{as:s,fontSize:"xl",mr:3}),n]})},Jn=({isCollapsed:s})=>{const{user:r,logout:n}=Me(),a=(r==null?void 0:r.perfil)==="ADMIN",t=j("white","gray.800"),l=j("gray.200","gray.700");return e.jsx(C,{as:"nav",pos:"fixed",top:"0",left:"0",zIndex:"sticky",h:"full",w:s?"72px":"240px",bg:t,borderRight:"1px",borderColor:l,transition:"width 0.2s ease-in-out",overflowY:"auto",display:{base:"none",md:"block"},children:e.jsxs(I,{direction:"column",p:s?2:4,h:"full",children:[e.jsxs(I,{align:"center",mb:4,pl:s?0:1,justify:s?"center":"flex-start",children:[e.jsx(De,{as:jn,fontSize:"2xl",color:"teal.500"}),!s&&e.jsx(V,{size:"md",ml:3,children:"Caipirão 3.0"})]}),e.jsx(Ue,{mb:4}),e.jsxs(Ks,{spacing:2,children:[e.jsx(He,{icon:qr,to:"/movimentacoes",children:"Movimentações"}),e.jsx(He,{icon:Ar,to:"/clientes",children:"Clientes"}),e.jsx(He,{icon:kr,to:"/produtos",children:"Produtos"})]}),a&&e.jsxs(Ks,{spacing:2,mt:8,children:[e.jsx(V,{size:"xs",textTransform:"uppercase",color:"gray.500",pl:3,children:"Admin"}),e.jsx(He,{icon:zr,to:"/dashboard",children:"Dashboard"}),e.jsx(He,{icon:Tr,to:"/relatorios",children:"Relatórios"}),e.jsx(He,{icon:Fr,to:"/fornecedores",children:"Fornecedores"}),e.jsx(He,{icon:Nr,to:"/utilizadores",children:"Utilizadores"}),e.jsx(He,{icon:Lr,to:"/empresa",children:"Minha Empresa"})]}),a&&e.jsxs(Ks,{spacing:2,mt:8,children:[e.jsx(V,{size:"xs",textTransform:"uppercase",color:"gray.500",pl:3,children:"Gestão Pessoal"}),e.jsx(He,{icon:Ir,to:"/financas",children:"Finanças"})]}),e.jsx(C,{flex:"1"}),e.jsxs(C,{mt:8,children:[e.jsx(Ue,{mb:4}),e.jsxs(I,{align:"center",p:2,children:[e.jsx(Br,{size:"sm",name:r==null?void 0:r.nome}),!s&&e.jsxs(C,{ml:3,children:[e.jsx(o,{fontWeight:"bold",fontSize:"sm",noOfLines:1,children:r==null?void 0:r.nome}),e.jsx(Fe,{colorScheme:(r==null?void 0:r.perfil)==="ADMIN"?"red":"green",fontSize:"2xs",children:r==null?void 0:r.perfil})]})]}),e.jsxs($e,{onClick:n,p:3,mt:2,display:"flex",alignItems:"center",borderRadius:"md",_hover:{bg:j("red.50","red.900"),color:j("red.600","red.200")},children:[e.jsx(De,{as:sr,fontSize:"xl",mr:3}),!s&&"Sair"]})]})]})})},Xs=({icon:s,label:r,to:n})=>{const t=nr().pathname===n,l="white",c=j("whiteAlpha.700","whiteAlpha.600");return e.jsxs($e,{as:rs,to:n,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:"1",py:2,color:t?l:c,fontWeight:t?"bold":"normal",_hover:{textDecoration:"none",color:"white"},transition:"color 0.2s ease-in-out",children:[e.jsx(De,{as:s,fontSize:"2xl"}),e.jsx(o,{fontSize:"xs",mt:1,children:r})]})},Xn=()=>{const{user:s,logout:r}=Me(),n=(s==null?void 0:s.perfil)==="ADMIN",a=j("blue.500","blue.800"),t=j("blue.600","blue.900"),l=j("whiteAlpha.700","whiteAlpha.600");return e.jsx(C,{as:"nav",pos:"fixed",bottom:"0",left:"0",right:"0",bg:a,borderTopWidth:"1px",borderColor:t,zIndex:"sticky",display:{base:"block",md:"none"},boxShadow:"0 -2px 10px rgba(0, 0, 0, 0.15)",children:e.jsxs(I,{align:"center",justify:"space-around",h:"60px",children:[e.jsx(Xs,{icon:qr,label:"Movim.",to:"/movimentacoes"}),e.jsx(Xs,{icon:Ar,label:"Clientes",to:"/clientes"}),e.jsx(Xs,{icon:kr,label:"Produtos",to:"/produtos"}),n?e.jsxs(pn,{children:[e.jsx(gn,{as:K,"aria-label":"Mais opções",icon:e.jsx(fn,{}),variant:"ghost",fontSize:"2xl",color:l,_hover:{bg:j("blue.600","blue.700")},flex:1,h:"full",py:2}),e.jsxs(bn,{children:[e.jsx(ls,{as:rs,to:"/dashboard",icon:e.jsx(zr,{}),children:"Dashboard"}),e.jsx(ls,{as:rs,to:"/relatorios",icon:e.jsx(Tr,{}),children:"Relatórios"}),e.jsx(ls,{as:rs,to:"/financas",icon:e.jsx(Ir,{}),children:"Finanças"}),e.jsx(ls,{as:rs,to:"/fornecedores",icon:e.jsx(Fr,{}),children:"Fornecedores"}),e.jsx(ls,{as:rs,to:"/utilizadores",icon:e.jsx(Nr,{}),children:"Utilizadores"}),e.jsx(ls,{as:rs,to:"/empresa",icon:e.jsx(Lr,{}),children:"Minha Empresa"})," ",e.jsx(ls,{icon:e.jsx(sr,{}),onClick:r,children:"Sair"})]})]}):e.jsxs($e,{onClick:r,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flex:"1",py:2,color:l,children:[e.jsx(De,{as:sr,fontSize:"2xl"}),e.jsx(o,{fontSize:"xs",mt:1,children:"Sair"})]})]})})},et=()=>{const{isAuthenticated:s,loading:r}=Me();return r?e.jsx(O,{h:"100vh",children:e.jsx(ge,{size:"xl"})}):s?e.jsx(tr,{}):e.jsx(Or,{to:"/login",replace:!0})},st=()=>{const{user:s}=Me();return(s==null?void 0:s.perfil)!=="ADMIN"?e.jsx(Or,{to:"/movimentacoes",replace:!0}):e.jsx(tr,{})},rt="http://localhost:3001/api",nt=ke.create({baseURL:rt}),tt=async s=>{var r,n;try{return(await nt.post("/auth/login",s)).data}catch(a){const t=((n=(r=a.response)==null?void 0:r.data)==null?void 0:n.error)||"Falha na autenticação. Verifique suas credenciais.";throw new Error(t)}},at=()=>{const[s,r]=m.useState(""),[n,a]=m.useState(""),[t,l]=m.useState(!1),c=Se(),{login:u}=Me(),d=ee({mutationFn:tt,onSuccess:x=>{u(x.token),c({title:"Login bem-sucedido!",status:"success",duration:3e3,isClosable:!0})},onError:x=>{var f,p;c({title:"Erro no login",description:((p=(f=x.response)==null?void 0:f.data)==null?void 0:p.error)||"Falha na autenticação. Verifique suas credenciais.",status:"error",duration:5e3,isClosable:!0})}}),i=x=>{if(x.preventDefault(),!s||!n){c({title:"Atenção",description:"Por favor, preencha todos os campos.",status:"warning",duration:3e3,isClosable:!0});return}d.mutate({credencial:s,senha:n})};return e.jsx(I,{minH:"100vh",align:"center",justify:"center",children:e.jsxs(C,{p:8,width:"full",maxWidth:"400px",borderWidth:1,borderRadius:8,boxShadow:"lg",children:[e.jsx("form",{onSubmit:i,children:e.jsxs(ae,{spacing:4,children:[e.jsx(V,{as:"h1",size:"lg",textAlign:"center",children:"Login Caipirão 3.0"}),e.jsxs(q,{isRequired:!0,isInvalid:d.isError,children:[e.jsx(A,{children:"Email, Nickname ou Telefone"}),e.jsx(T,{value:s,onChange:x=>r(x.target.value),placeholder:"Digite sua credencial"})]}),e.jsxs(q,{isRequired:!0,isInvalid:d.isError,children:[e.jsx(A,{children:"Senha"}),e.jsxs(Qe,{children:[e.jsx(T,{type:t?"text":"password",value:n,onChange:x=>a(x.target.value),placeholder:"********"}),e.jsx(yn,{children:e.jsx(K,{"aria-label":t?"Ocultar senha":"Mostrar senha",variant:"ghost",icon:t?e.jsx(vn,{}):e.jsx(Cn,{}),onMouseDown:()=>l(!0),onMouseUp:()=>l(!1),onTouchStart:()=>l(!0),onTouchEnd:()=>l(!1)})})]}),d.isError&&e.jsx(Z,{children:"Credenciais inválidas. Tente novamente."})]}),e.jsx(k,{type:"submit",colorScheme:"teal",width:"full",isLoading:d.isPending,children:"Entrar"})]})}),e.jsxs(o,{mt:6,textAlign:"center",children:["É novo por aqui?"," ",e.jsx($e,{as:ar,to:"/solicitar-acesso",color:"teal.500",fontWeight:"bold",children:"Solicitar Acesso"})]})]})})},ot="http://localhost:3001/api",Cs=ke.create({baseURL:`${ot}/dashboard`});Cs.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const it=async()=>(await Cs.get("/kpis")).data,lt=async()=>(await Cs.get("/vendas-por-dia")).data,dt=async()=>(await Cs.get("/ranking-produtos")).data,ct=async()=>(await Cs.get("/ranking-clientes")).data,ut=async s=>(await Cs.get("/fluxo-caixa-diario",{params:s})).data,ht="http://localhost:3001/api",ps=ke.create({baseURL:`${ht}/despesas`});ps.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const xt=async(s=1,r=10,n)=>(await ps.get("/",{params:{pagina:s,limite:r,termoBusca:n}})).data,mt=async s=>(await ps.post("/",s)).data,jt=async({id:s,data:r})=>(await ps.put(`/${s}`,r)).data,pt=async s=>{await ps.delete(`/${s}`)},Zr=async()=>(await ps.get("/a-pagar")).data,gt=async({id:s,quitacaoData:r})=>(await ps.put(`/${s}/quitar`,r)).data,Ps={kpis:{queryKey:["dashboardKPIs"],queryFn:it},vendasPorDia:{queryKey:["dashboardVendasPorDia"],queryFn:lt},rankingProdutos:{queryKey:["dashboardRankingProdutos"],queryFn:dt},rankingClientes:{queryKey:["dashboardRankingClientes"],queryFn:ct},contasAPagar:{queryKey:["dashboardContasAPagar"],queryFn:Zr}},ft=()=>{const r=re({...Ps.kpis,staleTime:3e5}),n=re({...Ps.vendasPorDia,staleTime:3e5}),a=re({...Ps.rankingProdutos,staleTime:3e5}),t=re({...Ps.rankingClientes,staleTime:3e5}),l=re({...Ps.contasAPagar,staleTime:3e5});return{kpisQuery:r,vendasPorDiaQuery:n,rankingProdutosQuery:a,rankingClientesQuery:t,contasAPagarQuery:l}},bt=s=>typeof s!="number"||isNaN(s)?"R$ 0":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",notation:"compact",maximumFractionDigits:1}).format(s),yt=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),vt=({data:s,isLoading:r,isError:n})=>{const a=j("green.500","green.300"),t=j("red.500","red.300"),[l,c]=Sn("colors",[a,t]),u=j("gray.600","gray.400"),d=j("gray.200","gray.700"),i=j("white","gray.800"),x=j("gray.300","gray.600");return r?e.jsx(O,{h:"350px",children:e.jsx(ge,{size:"xl"})}):n?e.jsx(O,{h:"350px",children:e.jsx(o,{color:"red.500",children:"Erro ao carregar dados do gráfico."})}):!s||s.length===0?e.jsx(O,{h:"350px",children:e.jsx(o,{color:"gray.500",children:"Não há dados de fluxo de caixa para exibir."})}):e.jsx(C,{h:"350px",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsxs(Ts,{data:s,margin:{top:5,right:20,left:20,bottom:5},children:[e.jsx(Fs,{stroke:d,strokeDasharray:"3 3"}),e.jsx(Ns,{dataKey:"dia",stroke:u,fontSize:12,tick:{fill:u}}),e.jsx(Ls,{tickFormatter:bt,stroke:u,fontSize:12,width:80,tick:{fill:u}}),e.jsx(xs,{formatter:(f,p)=>[yt(f),p],labelStyle:{color:u,fontWeight:"bold"},contentStyle:{backgroundColor:i,borderColor:x,borderRadius:"md",boxShadow:"lg"}}),e.jsx(Is,{wrapperStyle:{color:u}}),e.jsx(cs,{dataKey:"receitas",fill:l,name:"Receitas"}),e.jsx(cs,{dataKey:"despesas",fill:c,name:"Despesas"})]})})})},Yr=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),br=["#3182CE","#63B3ED","#4299E1"],Ct=s=>{const{payload:r}=s,n=j("gray.600","gray.400");return e.jsx(ae,{spacing:2,align:"center",mt:4,children:r.map((a,t)=>e.jsxs(W,{spacing:3,w:"full",justifyContent:"center",children:[e.jsx(C,{w:"12px",h:"12px",bg:a.color,borderRadius:"sm"}),e.jsx(o,{fontSize:"sm",color:n,isTruncated:!0,maxW:"150px",children:a.value}),e.jsxs(o,{fontSize:"sm",fontWeight:"bold",color:n,children:["(",Yr(a.payload.total_vendido),")"]})]},`item-${t}`))})},St=({data:s,isLoading:r,isError:n})=>{const a=j("white","gray.700"),t=j("gray.200","gray.600"),l="white";return r?e.jsx(O,{h:"250px",children:e.jsx(ge,{size:"xl"})}):n?e.jsx(O,{h:"250px",children:e.jsx(o,{color:"red.500",children:"Erro ao carregar ranking."})}):!s||s.length===0?e.jsx(O,{h:"250px",children:e.jsx(o,{color:"gray.500",children:"Nenhum produto vendido no mês."})}):e.jsx(C,{h:"250px",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsxs(Mr,{children:[e.jsx(xs,{formatter:(c,u)=>[Yr(c),u],contentStyle:{backgroundColor:a,borderColor:t,borderRadius:"md",boxShadow:"md"}}),e.jsx($r,{data:s,cx:"50%",cy:"50%",dataKey:"total_vendido",nameKey:"nome",outerRadius:80,fill:"#8884d8",paddingAngle:s.length>1?5:0,labelLine:!1,label:({cx:c,cy:u,midAngle:d,innerRadius:i,outerRadius:x,percent:f})=>{if(f<.07)return null;const p=(i+x)/2.5,S=c+p*Math.cos(-d*(Math.PI/180)),R=u+p*Math.sin(-d*(Math.PI/180));return e.jsx("text",{x:S,y:R,fill:l,textAnchor:"middle",dominantBaseline:"central",fontSize:"14px",fontWeight:"bold",children:`${(f*100).toFixed(0)}%`})},children:s.map((c,u)=>e.jsx(Wr,{fill:br[u%br.length],stroke:a},`cell-${u}`))}),e.jsx(Is,{content:Ct})]})})})},yr=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",notation:"compact",maximumFractionDigits:1}).format(s),wt=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),Dt=({data:s,isLoading:r,isError:n})=>{const a=j("#3182CE","#63B3ED"),t=j("gray.600","gray.400"),l=j("gray.700","gray.200"),c=j("gray.200","gray.700"),u=j("white","gray.800"),d=j("gray.300","gray.600");if(r)return e.jsx(O,{h:"250px",children:e.jsx(ge,{size:"xl"})});if(n)return e.jsx(O,{h:"250px",children:e.jsx(o,{color:"red.500",children:"Erro ao carregar ranking."})});if(!s||s.length===0)return e.jsx(O,{h:"250px",children:e.jsx(o,{color:"gray.500",children:"Nenhum cliente realizou compras no mês."})});const i=[...s].reverse();return e.jsx(C,{h:"250px",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsxs(Ts,{data:i,margin:{top:20,right:20,left:20,bottom:40},children:[e.jsx(Fs,{stroke:c,strokeDasharray:"3 3",vertical:!1}),e.jsx(Ns,{dataKey:"nome",stroke:t,fontSize:12,tick:{fill:t},angle:-45,textAnchor:"end",height:50,interval:0}),e.jsx(Ls,{stroke:t,fontSize:12,tick:{fill:t},tickFormatter:yr}),e.jsx(xs,{cursor:{fill:j("#00000010","#ffffff10")},formatter:x=>[wt(x),"Total Gasto"],contentStyle:{backgroundColor:u,borderColor:d,borderRadius:"md",boxShadow:"lg"}}),e.jsx(cs,{dataKey:"total_comprado",fill:a,radius:[4,4,0,0],children:e.jsx(Vr,{dataKey:"total_comprado",position:"top",formatter:yr,fill:l,fontSize:12,fontWeight:"bold"})})]})})})},Jr="http://localhost:3001/api",Bs=ke.create({baseURL:Jr});Bs.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const Xr=async(s=1,r=50,n)=>(await Bs.get("/utilizadores",{params:{pagina:s,limite:r,termoBusca:n}})).data,Rt=async s=>(await Bs.post("/utilizadores",s)).data,Pt=async s=>(await ke.post(`${Jr}/utilizadores/solicitar-acesso`,s)).data,en=async({id:s,data:r})=>(await Bs.put(`/utilizadores/${s}`,r)).data,Et=async s=>{await Bs.delete(`/utilizadores/${s}`)},_t=()=>{var he,fe,P;const{user:s}=Me(),r=ze(),n=Se(),{isOpen:a,onOpen:t,onClose:l}=xe(),{isOpen:c,onOpen:u,onClose:d}=xe(),[i,x]=m.useState(null),{register:f,handleSubmit:p,setValue:S,getValues:R,reset:D,formState:{errors:b}}=Oe(),L=m.useRef(null),y=j("yellow.50","yellow.900"),F=j("yellow.400","yellow.500"),B=j("red.100","red.800"),Q=j("whiteAlpha.800","whiteAlpha.100"),{data:U,isLoading:w,isError:$}=re({queryKey:["contasAPagar"],queryFn:Zr}),{data:H,isLoading:te}=re({queryKey:["utilizadores",1,1e3],queryFn:()=>Xr(1,1e3),select:h=>h.dados.filter(v=>v.perfil==="ADMIN"),enabled:a}),M=ee({mutationFn:gt,onSuccess:()=>{r.invalidateQueries({queryKey:["contasAPagar"]}),r.invalidateQueries({queryKey:["despesas"]}),r.invalidateQueries({queryKey:["dashboardKPIs"]}),n({title:"Pagamento registrado com sucesso!",status:"success"}),l(),d(),D()},onError:h=>{var v,g;n({title:"Erro ao quitar despesa",description:((g=(v=h.response)==null?void 0:v.data)==null?void 0:g.error)||h.message,status:"error"})}}),de=h=>{x(h),t()};m.useEffect(()=>{i&&a&&(S("data_pagamento",new Date().toISOString().split("T")[0]),S("valor_pago",i.valor),s&&S("responsavel_pagamento_id",s.id))},[i,a,S,s]);const ce=()=>{const h=R();if(i){const v={...h,responsavel_pagamento_id:Number(h.responsavel_pagamento_id),valor_pago:Number(h.valor_pago)};M.mutate({id:i.id,quitacaoData:v})}},X=h=>{i&&h.valor_pago<i.valor?u():ce()},ue=h=>{if(!h)return"Data inválida";const v=new Date(h);return fs(v)?v.toLocaleDateString("pt-BR",{timeZone:"UTC"}):"Data inválida"},le=h=>{if(!h)return!1;const v=Us(new Date),g=Kr(v,5),E=Us(new Date(h));return fs(E)?Ur(E,g):!1};return e.jsxs(C,{p:5,borderWidth:2,borderRadius:8,boxShadow:"md",h:"100%",bg:y,borderColor:F,children:[e.jsx(V,{size:"md",mb:4,children:"Contas a Pagar Pendentes"}),w&&e.jsx(ge,{}),$&&e.jsx(o,{color:"red.500",children:"Erro ao carregar contas a pagar."}),!w&&!$&&e.jsx(ae,{spacing:3,align:"stretch",overflowY:"auto",maxHeight:"300px",children:U&&U.length>0?U.map(h=>e.jsxs(C,{p:3,bg:le(h.data_vencimento)?B:Q,borderRadius:"md",boxShadow:"sm",children:[e.jsxs(I,{justify:"space-between",align:{base:"flex-start",md:"center"},direction:{base:"column",md:"row"},children:[e.jsxs(ae,{align:"start",spacing:0,mb:{base:2,md:0},children:[e.jsx(o,{fontWeight:"bold",children:h.nome_fornecedor||"Despesa sem fornecedor"}),e.jsxs(o,{fontSize:"sm",children:["Vence em: ",ue(h.data_vencimento)]})]}),e.jsx(o,{fontWeight:"bold",color:"red.500",fontSize:"lg",mb:{base:2,md:0},children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(h.valor)}),(s==null?void 0:s.perfil)==="ADMIN"&&e.jsx(k,{display:{base:"none",md:"inline-flex"},colorScheme:"green",size:"sm",onClick:()=>de(h),children:"Quitar"})]}),(s==null?void 0:s.perfil)==="ADMIN"&&e.jsxs(e.Fragment,{children:[e.jsx(Ue,{my:2,display:{base:"block",md:"none"}}),e.jsx(k,{display:{base:"inline-flex",md:"none"},colorScheme:"green",size:"sm",w:"full",onClick:()=>de(h),children:"Quitar"})]})]},h.id)):e.jsx(o,{color:"gray.500",textAlign:"center",pt:8,children:"Nenhuma conta a pagar pendente."})}),e.jsxs(ys,{isOpen:a,onClose:l,isCentered:!0,children:[e.jsx(me,{}),e.jsxs(vs,{as:"form",onSubmit:p(X),children:[e.jsx(je,{children:"Quitar Despesa"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(o,{children:["Confirmar quitação para ",e.jsx("strong",{children:(i==null?void 0:i.nome_fornecedor)||"esta despesa"})," no valor total de ",e.jsx("strong",{children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((i==null?void 0:i.valor)||0)}),"?"]}),e.jsxs(q,{isRequired:!0,isInvalid:!!b.valor_pago,children:[e.jsx(A,{children:"Valor a Pagar"}),e.jsxs(Qe,{children:[e.jsx(wn,{children:"R$"}),e.jsx(T,{type:"number",step:"0.01",...f("valor_pago",{required:"O valor é obrigatório",valueAsNumber:!0,min:{value:.01,message:"O valor deve ser maior que zero."},validate:h=>h<=((i==null?void 0:i.valor)||0)||`O valor não pode ser maior que ${new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format((i==null?void 0:i.valor)||0)}`})})]}),e.jsx(Z,{children:(he=b.valor_pago)==null?void 0:he.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!b.data_pagamento,children:[e.jsx(A,{children:"Data de Pagamento"}),e.jsx(T,{type:"date",...f("data_pagamento",{required:"A data é obrigatória"})}),e.jsx(Z,{children:(fe=b.data_pagamento)==null?void 0:fe.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!b.responsavel_pagamento_id,children:[e.jsx(A,{children:"Responsável pelo Pagamento"}),e.jsx(Je,{placeholder:te?"Carregando...":"Selecione um responsável",...f("responsavel_pagamento_id",{required:"O responsável é obrigatório",valueAsNumber:!0}),disabled:te,children:H==null?void 0:H.map(h=>e.jsx("option",{value:h.id,children:h.nome},h.id))}),e.jsx(Z,{children:(P=b.responsavel_pagamento_id)==null?void 0:P.message})]})]})}),e.jsxs(ye,{children:[e.jsx(k,{variant:"ghost",mr:3,onClick:l,children:"Cancelar"}),e.jsx(k,{colorScheme:"green",type:"submit",isLoading:M.isPending,children:"Confirmar Pagamento"})]})]})]}),e.jsx(ms,{isOpen:c,leastDestructiveRef:L,onClose:d,isCentered:!0,children:e.jsx(me,{children:e.jsxs(js,{children:[e.jsx(je,{fontSize:"lg",fontWeight:"bold",children:"Confirmar Pagamento Parcial"}),e.jsxs(pe,{children:["O valor informado é ",e.jsx("strong",{children:"menor"})," que o valor total da dívida. Uma nova conta pendente será mantida com o valor restante. Deseja continuar?"]}),e.jsxs(ye,{children:[e.jsx(k,{ref:L,onClick:d,children:"Cancelar"}),e.jsx(k,{colorScheme:"green",onClick:ce,ml:3,isLoading:M.isPending,children:"Sim, Continuar"})]})]})})})]})},Es=s=>s===void 0?"N/D":s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),Ws=s=>Ye(s,"yyyy-MM-dd"),vr=()=>{const s={transform:"translateY(-4px)",boxShadow:"xl"},r=j("blue.200","blue.600"),{kpisQuery:n,rankingProdutosQuery:a,rankingClientesQuery:t}=ft(),[l,c]=m.useState({startDate:Ws(Qs(new Date,29)),endDate:Ws(new Date)}),[u,d]=m.useState("30d"),{data:i,isLoading:x,isError:f}=n,{data:p,isLoading:S,isError:R}=a,{data:D,isLoading:b,isError:L}=t,{data:y,isLoading:F,isError:B}=re({queryKey:["dashboardFluxoCaixa",l],queryFn:()=>ut(l),staleTime:1e3*60*5}),Q=(w,$,H)=>{c({startDate:Ws(w),endDate:Ws($)}),d(H)},U=(w,$)=>{c(H=>({...H,[$]:w.target.value})),d("custom")};return x?e.jsx(O,{p:8,minH:"50vh",children:e.jsx(ge,{size:"xl"})}):f?e.jsx(O,{p:8,children:e.jsx(o,{color:"red.500",fontSize:"lg",children:"Erro ao carregar os dados do Dashboard."})}):e.jsxs(C,{children:[e.jsx(V,{as:"h1",size:"lg",mb:6,children:"Dashboard"}),e.jsxs(ns,{columns:{base:1,md:2,lg:3},spacing:6,children:[e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsx(_e,{children:"Receita (Mês)"}),e.jsx(qe,{color:"green.500",children:Es(i==null?void 0:i.totalVendasMes)}),e.jsx(Ae,{children:"Total de vendas no mês atual."})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsx(_e,{children:"Despesas (Mês)"}),e.jsx(qe,{color:"red.500",children:Es(i==null?void 0:i.totalDespesasMes)}),e.jsx(Ae,{children:"Total de despesas no mês atual."})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsx(_e,{children:"Saldo (Mês)"}),e.jsx(qe,{color:i&&i.saldoMes>=0?"blue.500":"red.500",children:Es(i==null?void 0:i.saldoMes)}),e.jsxs(Ae,{children:[e.jsx(Qr,{type:i&&i.saldoMes>=0?"increase":"decrease"}),"Balanço do mês atual"]})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsx(_e,{children:"Contas a Receber"}),e.jsx(qe,{children:Es(i==null?void 0:i.totalContasAReceber)}),e.jsx(Ae,{children:"Total de vendas a prazo pendentes."})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsx(_e,{children:"Contas a Pagar"}),e.jsx(qe,{children:Es(i==null?void 0:i.totalContasAPagar)}),e.jsx(Ae,{children:"Total de despesas pendentes."})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsx(_e,{children:"Novos Clientes (Mês)"}),e.jsx(qe,{children:(i==null?void 0:i.novosClientesMes)??"N/D"}),e.jsx(Ae,{children:"Clientes cadastrados no mês atual."})]})]}),e.jsxs(ns,{columns:{base:1,lg:2},spacing:6,mt:8,children:[e.jsxs(C,{borderWidth:1,borderRadius:"md",p:4,boxShadow:"sm",minH:"400px",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsxs(I,{justify:"space-between",align:"center",mb:4,direction:{base:"column",md:"row"},gap:2,children:[e.jsx(V,{as:"h2",size:"md",children:"Fluxo de Caixa"}),e.jsxs(W,{children:[e.jsx(k,{size:"xs",colorScheme:u==="week"?"teal":"gray",onClick:()=>Q(Rn(new Date),Dn(new Date),"week"),children:"7 dias"}),e.jsx(k,{size:"xs",colorScheme:u==="15d"?"teal":"gray",onClick:()=>Q(Qs(new Date,14),new Date,"15d"),children:"15 dias"}),e.jsx(k,{size:"xs",colorScheme:u==="month"?"teal":"gray",onClick:()=>Q(As(new Date),qs(new Date),"month"),children:"Mês"})]})]}),e.jsxs(W,{mb:4,spacing:2,children:[e.jsx(T,{type:"date",size:"sm",value:l.startDate,onChange:w=>U(w,"startDate")}),e.jsx(o,{children:"até"}),e.jsx(T,{type:"date",size:"sm",value:l.endDate,onChange:w=>U(w,"endDate")})]}),e.jsx(vt,{data:y,isLoading:F,isError:B})]}),e.jsx(_t,{})]}),e.jsxs(ns,{columns:{base:1,lg:2},spacing:6,mt:8,children:[e.jsxs(C,{w:"full",borderWidth:1,borderRadius:"md",p:4,boxShadow:"sm",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsx(V,{as:"h2",size:"md",mb:4,children:"Top 2 Produtos (Mês)"}),e.jsx(St,{data:p,isLoading:S,isError:R})]}),e.jsxs(C,{w:"full",borderWidth:1,borderRadius:"md",p:4,boxShadow:"sm",transition:"all 0.2s ease-in-out",_hover:s,borderColor:r,children:[e.jsx(V,{as:"h2",size:"md",mb:4,children:"Top 5 Clientes (Mês)"}),e.jsx(Dt,{data:D,isLoading:b,isError:L})]})]})]})},us=(s,r)=>{const[n,a]=m.useState(s);return m.useEffect(()=>{const t=setTimeout(()=>{a(s)},r);return()=>{clearTimeout(t)}},[s,r]),n},qt="http://localhost:3001/api",Ss=ke.create({baseURL:qt});Ss.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const At=async(s=1,r=50,n)=>(await Ss.get("/movimentacoes/vendas",{params:{pagina:s,limite:r,termoBusca:n}})).data,kt=async s=>(await Ss.post("/movimentacoes/vendas",s)).data,zt=async({id:s,data:r})=>(await Ss.put(`/movimentacoes/vendas/${s}`,r)).data,Tt=async s=>{await Ss.delete(`/movimentacoes/vendas/${s}`)},Ft=async s=>{const r=await Ss.get(`/movimentacoes/vendas/${s}/pdf`,{responseType:"blob"});return new Blob([r.data],{type:"application/pdf"})},Nt="http://localhost:3001/api",ws=ke.create({baseURL:Nt});ws.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const sn=async(s=1,r=10,n)=>(await ws.get("/clientes",{params:{pagina:s,limite:r,termoBusca:n}})).data,Lt=async s=>(await ws.post("/clientes",s)).data,It=async(s,r)=>(await ws.put(`/clientes/${s}`,r)).data,Bt=async s=>{await ws.delete(`/clientes/${s}`)},Ot=async s=>(await ws.get(`/clientes/${s}/historico`)).data,Mt="http://localhost:3001/api",Ds=ke.create({baseURL:Mt});Ds.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const rn=async(s=1,r=50,n)=>(await Ds.get("/produtos",{params:{pagina:s,limite:r,termoBusca:n}})).data,$t=async s=>(await Ds.post("/produtos",s)).data,Wt=async(s,r)=>(await Ds.put(`/produtos/${s}`,r)).data,Vt=async s=>{await Ds.delete(`/produtos/${s}`)},Kt=async({id:s,data:r})=>(await Ds.post(`/produtos/${s}/entradas-estoque`,r)).data,Ut=({isOpen:s,onClose:r,vendaParaEditar:n})=>{const a=ze(),t=Se(),{user:l}=Me(),[c,u]=m.useState([]),[d,i]=m.useState("À VISTA"),[x,f]=m.useState(null),[p,S]=m.useState(""),R=us(p,500),D=ve({base:"full",md:"xl"}),b=ve({base:"column",md:"row"}),{control:L,register:y,handleSubmit:F,watch:B,reset:Q,setValue:U,getValues:w,formState:{errors:$}}=Oe({defaultValues:{cliente_id:"",data_venda:new Date().toISOString().split("T")[0],data_vencimento:"",produto_selecionado_id:"",quantidade:"",preco_manual:""}}),H=B("produto_selecionado_id"),te=B("quantidade"),M=B("preco_manual"),{data:de,isLoading:ce}=re({queryKey:["clientesParaVenda",R],queryFn:()=>sn(1,1e3,R),placeholderData:We,enabled:s}),{data:X}=re({queryKey:["todosProdutos"],queryFn:()=>rn(1,1e3),enabled:s,select:g=>g.dados}),ue=B("data_venda");m.useEffect(()=>{if(H&&X){const g=X.find(E=>E.id===Number(H));f(g?g.quantidade_em_estoque:null)}else f(null)},[H,X]);const le=m.useMemo(()=>c.reduce((g,E)=>{const oe=E.preco_manual??E.preco_original;return g+E.quantidade*oe},0),[c]),he=m.useMemo(()=>{const g=X==null?void 0:X.find(be=>be.id===Number(H));if(!g||!te)return le;const E=Number(M)||g.price,oe=Number(te)*E;return le+oe},[le,X,H,te,M]),fe=ee({mutationFn:g=>g.id?zt({id:g.id,data:g.vendaData}):kt(g.vendaData),onSuccess:()=>{a.invalidateQueries({queryKey:["vendas"]}),a.invalidateQueries({queryKey:["produtos"]}),t({title:`Venda ${n?"atualizada":"registrada"}!`,status:"success",duration:3e3,isClosable:!0}),r()},onError:g=>{var E,oe;t({title:"Erro ao salvar venda",description:((oe=(E=g.response)==null?void 0:E.data)==null?void 0:oe.error)||g.message,status:"error",duration:6e3,isClosable:!0})}});m.useEffect(()=>{if(s)if(n){U("cliente_id",String(n.cliente_id)),S(n.cliente_nome),U("data_venda",n.data_venda.split("T")[0]),i(n.opcao_pagamento),U("data_vencimento",n.data_vencimento?n.data_vencimento.split("T")[0]:"");const g=n.produtos.map(E=>({produto_id:E.produto_id,quantidade:E.quantidade,preco_manual:E.preco_manual,nome:E.nome,unidade_medida:E.unidade_medida,preco_original:E.valor_unitario}));u(g)}else Q({cliente_id:"",data_venda:new Date().toISOString().split("T")[0],data_vencimento:"",produto_selecionado_id:"",quantidade:"",preco_manual:""}),u([]),i("À VISTA"),S("")},[s,n,Q,U]),m.useEffect(()=>{d==="À VISTA"&&U("data_vencimento",ue)},[d,ue,U]);const P=()=>{const{produto_selecionado_id:g,quantidade:E,preco_manual:oe}=w();if(!g||!E||Number(E)<=0){t({title:"Produto ou quantidade inválida",status:"warning",duration:3e3,isClosable:!0});return}const be=X==null?void 0:X.find(Y=>Y.id===Number(g));if(be){if(be.quantidade_em_estoque<Number(E)){t({title:"Estoque Insuficiente!",description:`Você tentou adicionar ${E} ${be.unidade_medida} de "${be.nome}", mas há apenas ${be.quantidade_em_estoque} em estoque.`,status:"error",duration:6e3,isClosable:!0});return}if(c.some(Y=>Y.produto_id===be.id)){t({title:"Produto já adicionado",status:"warning",duration:2e3,isClosable:!0});return}u(Y=>[...Y,{produto_id:be.id,quantidade:Number(E),preco_manual:oe?Number(oe):void 0,nome:be.nome,unidade_medida:be.unidade_medida,preco_original:be.price}]),U("produto_selecionado_id",""),U("quantidade",""),U("preco_manual","")}},h=g=>{u(E=>E.filter(oe=>oe.produto_id!==g))},v=g=>{if(c.length===0){t({title:"Nenhum produto na venda",description:"Adicione pelo menos um produto antes de salvar.",status:"error"});return}const E={cliente_id:Number(g.cliente_id),data_venda:g.data_venda,opcao_pagamento:d,data_vencimento:g.data_vencimento,produtos:c.map(oe=>({produto_id:oe.produto_id,quantidade:oe.quantidade,preco_manual:oe.preco_manual}))};fe.mutate({vendaData:E,id:n==null?void 0:n.id})};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:D,children:[e.jsx(me,{}),e.jsx(ss,{children:e.jsxs("form",{onSubmit:F(v),children:[e.jsx(je,{borderBottomWidth:"1px",children:n?"Editar Venda":"Registrar Nova Venda"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,align:"stretch",children:[e.jsxs(I,{direction:b,gap:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!$.cliente_id,flex:1,children:[e.jsx(A,{children:"Cliente"}),e.jsx(T,{placeholder:"Digite para buscar um cliente...",value:p,onChange:g=>{S(g.target.value),w("cliente_id")&&U("cliente_id","")}}),ce&&e.jsx(ge,{size:"sm",mt:2}),de&&p&&w("cliente_id")===""&&e.jsx(ae,{mt:1,borderWidth:1,borderRadius:"md",maxH:"150px",overflowY:"auto",align:"stretch",spacing:0,bg:j("white","gray.700"),zIndex:"dropdown",position:"absolute",width:"98%",children:de.dados.length>0?de.dados.map(g=>e.jsx(k,{onClick:()=>{U("cliente_id",String(g.id),{shouldValidate:!0}),S(g.nome)},justifyContent:"flex-start",variant:"ghost",borderRadius:0,children:g.nome},g.id)):e.jsx(o,{p:2,color:"gray.500",children:"Nenhum cliente encontrado."})}),e.jsx(Z,{children:$.cliente_id&&"Selecione um cliente da lista."})]}),e.jsxs(q,{isRequired:!0,flex:1,children:[e.jsx(A,{children:"Data da Venda"}),e.jsx(T,{type:"date",...y("data_venda")})]})]}),e.jsxs(I,{direction:b,gap:4,children:[e.jsxs(q,{isRequired:!0,flex:1,children:[e.jsx(A,{children:"Opção de Pagamento"}),e.jsxs(Je,{value:d,onChange:g=>i(g.target.value),children:[e.jsx("option",{value:"À VISTA",children:"À VISTA"}),e.jsx("option",{value:"A PRAZO",children:"A PRAZO"})]})]}),e.jsxs(q,{isRequired:d==="A PRAZO",flex:1,children:[e.jsx(A,{children:"Data de Vencimento"}),e.jsx(T,{type:"date",...y("data_vencimento"),isDisabled:d==="À VISTA"})]})]}),e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",mt:4,children:[e.jsx(V,{size:"sm",mb:3,children:"Adicionar Produtos"}),e.jsxs(I,{direction:b,gap:2,align:"flex-end",children:[e.jsxs(q,{flex:3,children:[e.jsx(A,{children:"Produto"}),e.jsx(Je,{placeholder:"Selecione...",...y("produto_selecionado_id"),children:X==null?void 0:X.map(g=>e.jsx("option",{value:g.id,children:g.nome},g.id))})]}),e.jsxs(q,{flex:1,children:[e.jsx(A,{children:"Estoque Atual"}),e.jsx(T,{isReadOnly:!0,value:x!==null?x:"---",textAlign:"center",fontWeight:"bold",bg:j("gray.100","gray.600"),borderColor:x!==null&&x<=0?"red.500":j("gray.200","gray.600"),color:x!==null&&x<=0?"red.500":"inherit"})]}),e.jsxs(q,{flex:1,children:[e.jsx(A,{children:"Qtd/ Peso"}),e.jsx(or,{name:"quantidade",control:L,render:({field:g})=>e.jsx(ks,{...g,min:.001,precision:3,children:e.jsx(zs,{placeholder:"Info Qtd/Peso"})})})]}),e.jsxs(q,{flex:1,children:[e.jsx(A,{children:"Preço Manual (R$)"}),e.jsx(T,{placeholder:"Opcional",...y("preco_manual"),type:"number",step:"0.01"})]}),e.jsx(k,{colorScheme:"green",onClick:P,alignSelf:{base:"stretch",md:"flex-end"},children:e.jsx(Xe,{})})]})]}),e.jsx(ae,{spacing:2,align:"stretch",mt:4,children:c.map(g=>e.jsxs(I,{justify:"space-between",align:"center",p:2,borderWidth:1,borderRadius:"md",children:[e.jsxs(C,{children:[e.jsx(o,{fontWeight:"bold",children:g.nome}),e.jsxs(o,{fontSize:"sm",color:"gray.500",children:[g.quantidade," ",g.unidade_medida," x ",(g.preco_manual??g.preco_original).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),g.preco_manual!==void 0&&e.jsx(Fe,{ml:2,colorScheme:"orange",children:"Manual"})]})]}),e.jsx(K,{"aria-label":"Remover",icon:e.jsx(Re,{}),size:"sm",colorScheme:"red",onClick:()=>h(g.produto_id)})]},g.produto_id))}),e.jsx(I,{justify:"flex-end",mt:4,children:e.jsxs(C,{textAlign:"right",children:[e.jsxs(o,{fontSize:"lg",children:["Vendedor: ",l==null?void 0:l.nome]}),e.jsxs(V,{size:"lg",color:"teal.500",children:["Total: ",he.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})]})]})})]})}),e.jsxs(ye,{borderBottomWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"teal",type:"submit",isLoading:fe.isPending,children:"Salvar Venda"})]})]})})]})},Qt="http://localhost:3001/api",Os=ke.create({baseURL:`${Qt}/fornecedores`});Os.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const nn=async(s=1,r=50,n)=>(await Os.get("/",{params:{pagina:s,limite:r,termoBusca:n}})).data,Gt=async s=>(await Os.post("/",s)).data,Ht=async({id:s,...r})=>(await Os.put(`/${s}`,r)).data,Zt=async s=>{await Os.delete(`/${s}`)},Yt=["Compra de Aves","Insumos de Produção","Mão de Obra","Materiais e Embalagens","Despesas Operacionais","Encargos e Tributos","Despesas Administrativas","Financeiras","Remuneração de Sócios","Outros"],Jt=({isOpen:s,onClose:r,despesaParaEditar:n})=>{var S,R,D,b,L;const a=ze(),t=Se(),l=ve({base:"full",md:"md"}),{register:c,handleSubmit:u,reset:d,formState:{errors:i}}=Oe(),{data:x}=re({queryKey:["todosFornecedores"],queryFn:()=>nn(1,1e3),enabled:s,select:y=>y.dados}),f=ee({mutationFn:y=>y.id?jt({id:y.id,data:y.despesaData}):mt(y.despesaData),onSuccess:()=>{a.invalidateQueries({queryKey:["despesas"]}),a.invalidateQueries({queryKey:["contasAPagar"]}),a.invalidateQueries({queryKey:["dashboardKPIs"]}),t({title:`Despesa ${n?"atualizada":"registrada"}!`,status:"success",duration:3e3,isClosable:!0}),r()},onError:y=>{var F,B;t({title:"Erro ao salvar despesa",description:((B=(F=y.response)==null?void 0:F.data)==null?void 0:B.error)||y.message,status:"error",duration:5e3,isClosable:!0})}});m.useEffect(()=>{s&&d(n?{...n,data_compra:n.data_compra.split("T")[0],data_vencimento:n.data_vencimento.split("T")[0]}:{discriminacao:"",tipo_saida:"",valor:"",data_compra:new Date().toISOString().split("T")[0],data_vencimento:new Date().toISOString().split("T")[0],fornecedor_id:void 0})},[s,n,d]);const p=y=>{const F={...y,valor:Number(y.valor),fornecedor_id:y.fornecedor_id?Number(y.fornecedor_id):null};f.mutate({despesaData:F,id:n==null?void 0:n.id})};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:l,children:[e.jsx(me,{}),e.jsx(ss,{children:e.jsxs("form",{onSubmit:u(p),children:[e.jsx(je,{borderBottomWidth:"1px",children:n?"Editar Despesa":"Registrar Nova Despesa"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!i.tipo_saida,children:[e.jsx(A,{children:"Tipo de Saída"}),e.jsx(Je,{placeholder:"Selecione o tipo da despesa",...c("tipo_saida",{required:"Tipo é obrigatório"}),children:Yt.map(y=>e.jsx("option",{value:y,children:y},y))}),e.jsx(Z,{children:(S=i.tipo_saida)==null?void 0:S.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!i.valor,children:[e.jsx(A,{children:"Valor (R$)"}),e.jsx(T,{placeholder:"Ex: 852.50",type:"text",inputMode:"decimal",...c("valor",{required:"Valor é obrigatório",valueAsNumber:!0,validate:{isNumber:y=>!isNaN(parseFloat(String(y)))||"Por favor, insira um valor numérico válido.",isPositive:y=>parseFloat(String(y))>0||"O valor deve ser maior que zero."}})}),e.jsx(Z,{children:(R=i.valor)==null?void 0:R.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!i.discriminacao,children:[e.jsx(A,{children:"Discriminação (Detalhes)"}),e.jsx(ir,{placeholder:"Detalhes da despesa...",...c("discriminacao",{required:"A descrição é obrigatória"})}),e.jsx(Z,{children:(D=i.discriminacao)==null?void 0:D.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!i.data_compra,children:[e.jsx(A,{children:"Data da Compra"}),e.jsx(T,{type:"date",...c("data_compra",{required:"Data da compra é obrigatória"})}),e.jsx(Z,{children:(b=i.data_compra)==null?void 0:b.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!i.data_vencimento,children:[e.jsx(A,{children:"Data de Vencimento"}),e.jsx(T,{type:"date",...c("data_vencimento",{required:"Data de vencimento é obrigatória"})}),e.jsx(Z,{children:(L=i.data_vencimento)==null?void 0:L.message})]}),e.jsxs(q,{children:[e.jsx(A,{children:"Fornecedor/Credor (Opcional)"}),e.jsx(Je,{placeholder:"Selecione um fornecedor",...c("fornecedor_id"),children:x==null?void 0:x.map(y=>e.jsx("option",{value:y.id,children:y.nome},y.id))})]})]})}),e.jsxs(ye,{borderBottomWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"red",type:"submit",isLoading:f.isPending,children:"Salvar Despesa"})]})]})})]})},os=({paginaAtual:s,totalPaginas:r,onPageChange:n})=>e.jsxs(I,{justify:"space-between",align:"center",mt:6,children:[e.jsx(k,{onClick:()=>n(s-1),isDisabled:s<=1,children:"Anterior"}),e.jsxs(o,{children:["Página ",e.jsx("strong",{children:s})," de ",e.jsx("strong",{children:r})]}),e.jsx(k,{onClick:()=>n(s+1),isDisabled:s>=r,children:"Próxima"})]}),Xt=({onEdit:s,onDelete:r,onGeneratePdf:n,buscaDebounced:a})=>{const[t,l]=m.useState(1),c=ve({base:!0,md:!1}),u=m.useRef(null);m.useEffect(()=>{a&&l(1)},[a]);const{data:d,isLoading:i,isError:x}=re({queryKey:["vendas",t,a],queryFn:()=>At(t,50,a),placeholderData:We});m.useEffect(()=>{u.current&&u.current.scrollTo(0)},[d]);const f=j("gray.50","gray.700"),p=j("gray.100","gray.700"),S=j("gray.200","gray.600");if(i&&!d)return e.jsx(O,{p:10,children:e.jsx(ge,{size:"xl"})});if(x)return e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Não foi possível carregar as vendas."})});if(c)return e.jsxs(e.Fragment,{children:[e.jsx(ae,{spacing:4,align:"stretch",mt:4,children:d==null?void 0:d.dados.map(D=>e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",boxShadow:"sm",children:[e.jsxs(I,{justify:"space-between",align:"center",children:[e.jsx(V,{size:"sm",noOfLines:1,children:D.cliente_nome}),e.jsxs(W,{spacing:1,children:[e.jsx(ne,{label:"Gerar PDF",hasArrow:!0,children:e.jsx(K,{"aria-label":"Gerar PDF",icon:e.jsx(xr,{}),size:"sm",colorScheme:"blue",onClick:()=>n(D.id)})}),e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),size:"sm",onClick:()=>s(D)}),e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),size:"sm",colorScheme:"red",onClick:()=>r(D.id)})]})]}),e.jsx(Ue,{my:2}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Data:"}),e.jsx(o,{children:new Date(D.data_venda).toLocaleDateString("pt-BR",{timeZone:"UTC"})})]}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Status:"}),e.jsx(Fe,{colorScheme:D.data_pagamento?"green":"red",children:D.data_pagamento?"Pago":"Pendente"})]}),e.jsxs(W,{justify:"space-between",mt:2,children:[e.jsx(o,{fontWeight:"bold",children:"Total:"}),e.jsx(o,{fontWeight:"bold",color:"teal.500",children:D.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]})]},D.id))}),e.jsx(os,{paginaAtual:(d==null?void 0:d.pagina)||1,totalPaginas:(d==null?void 0:d.totalPaginas)||1,onPageChange:l})]});const R=({index:D,style:b})=>{const L=d.dados[D];return e.jsxs(I,{style:b,align:"center",_hover:{bg:p},borderBottomWidth:"1px",borderColor:S,children:[e.jsx(o,{width:"15%",px:4,isTruncated:!0,children:new Date(L.data_venda).toLocaleDateString("pt-BR",{timeZone:"UTC"})}),e.jsx(o,{width:"35%",px:4,isTruncated:!0,title:L.cliente_nome,children:L.cliente_nome}),e.jsx(o,{width:"15%",px:4,isTruncated:!0,children:L.opcao_pagamento}),e.jsx(C,{width:"10%",px:4,children:e.jsx(Fe,{colorScheme:L.data_pagamento?"green":"red",children:L.data_pagamento?"Pago":"Pendente"})}),e.jsx(I,{width:"15%",px:4,justify:"flex-end",children:e.jsx(o,{isTruncated:!0,children:L.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})}),e.jsx(I,{width:"10%",px:4,justify:"flex-start",children:e.jsxs(W,{spacing:2,children:[e.jsx(ne,{label:"Gerar PDF",hasArrow:!0,children:e.jsx(K,{"aria-label":"Gerar PDF",icon:e.jsx(xr,{}),size:"sm",colorScheme:"blue",onClick:()=>n(L.id)})}),e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),size:"sm",onClick:()=>s(L)}),e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),size:"sm",colorScheme:"red",onClick:()=>r(L.id)})]})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[e.jsxs(I,{bg:f,borderBottomWidth:"1px",fontWeight:"bold",role:"row",pr:"15px",children:[e.jsx(o,{width:"15%",p:4,children:"Data"}),e.jsx(o,{width:"35%",p:4,children:"Cliente"}),e.jsx(o,{width:"15%",p:4,children:"Pagamento"}),e.jsx(o,{width:"10%",p:4,children:"Status"}),e.jsx(o,{width:"15%",p:4,textAlign:"right",children:"Valor"}),e.jsx(o,{width:"10%",p:4,children:"Ações"})]}),d!=null&&d.dados&&d.dados.length>0?e.jsx(Ge,{height:500,itemCount:d.dados.length,itemSize:62,width:"100%",ref:u,children:R}):e.jsx(O,{p:10,children:e.jsx(o,{children:"Nenhuma venda encontrada."})})]}),e.jsx(os,{paginaAtual:(d==null?void 0:d.pagina)||1,totalPaginas:(d==null?void 0:d.totalPaginas)||1,onPageChange:l})]})},ea=({onEdit:s,onDelete:r,buscaDebounced:n})=>{const[a,t]=m.useState(1),{user:l}=Me(),c=(l==null?void 0:l.perfil)==="ADMIN",u=ve({base:!0,md:!1}),d=m.useRef(null);m.useEffect(()=>{n&&t(1)},[n]);const{data:i,isLoading:x,isError:f}=re({queryKey:["despesas",a,n],queryFn:()=>xt(a,50,n),placeholderData:We});m.useEffect(()=>{d.current&&d.current.scrollTo(0)},[i]);const p=j("gray.50","gray.700"),S=j("gray.100","gray.700"),R=j("gray.200","gray.600");if(x&&!i)return e.jsx(O,{p:10,children:e.jsx(ge,{size:"xl"})});if(f)return e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Não foi possível carregar as despesas."})});if(u)return e.jsxs(e.Fragment,{children:[e.jsx(ae,{spacing:4,align:"stretch",mt:4,children:i==null?void 0:i.dados.map(b=>e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",boxShadow:"sm",children:[e.jsxs(I,{justify:"space-between",align:"center",children:[e.jsx(V,{size:"sm",noOfLines:1,children:b.discriminacao}),c&&e.jsxs(W,{spacing:1,children:[e.jsx(ne,{label:"Não é possível editar um registro de pagamento parcial",isDisabled:!b.discriminacao.startsWith("PAGAMENTO PARCIAL"),children:e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),size:"sm",onClick:()=>s(b),isDisabled:b.discriminacao.startsWith("PAGAMENTO PARCIAL")})}),e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),size:"sm",colorScheme:"red",onClick:()=>r(b.id)})]})]}),e.jsx(o,{fontSize:"sm",color:"gray.400",mt:1,children:b.tipo_saida}),e.jsx(Ue,{my:2}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Data da Compra:"}),e.jsx(o,{children:new Date(b.data_compra).toLocaleDateString("pt-BR",{timeZone:"UTC"})})]}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Vencimento:"}),e.jsx(o,{children:new Date(b.data_vencimento).toLocaleDateString("pt-BR",{timeZone:"UTC"})})]}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Status:"}),e.jsx(Fe,{colorScheme:b.data_pagamento?"green":"orange",children:b.data_pagamento?"Pago":"Pendente"})]}),e.jsxs(W,{justify:"space-between",mt:2,children:[e.jsx(o,{fontWeight:"bold",children:"Valor:"}),e.jsx(o,{fontWeight:"bold",color:"red.500",children:b.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]})]},b.id))}),e.jsx(os,{paginaAtual:(i==null?void 0:i.pagina)||1,totalPaginas:(i==null?void 0:i.totalPaginas)||1,onPageChange:t})]});const D=({index:b,style:L})=>{const y=i.dados[b];return e.jsxs(I,{style:L,align:"center",_hover:{bg:S},borderBottomWidth:"1px",borderColor:R,children:[e.jsx(o,{width:"12%",px:4,isTruncated:!0,children:new Date(y.data_compra).toLocaleDateString("pt-BR",{timeZone:"UTC"})}),e.jsx(o,{width:"12%",px:4,isTruncated:!0,children:new Date(y.data_vencimento).toLocaleDateString("pt-BR",{timeZone:"UTC"})}),e.jsx(o,{width:"31%",px:4,isTruncated:!0,title:y.discriminacao,children:y.discriminacao}),e.jsx(o,{width:"15%",px:4,isTruncated:!0,children:y.tipo_saida}),e.jsx(C,{width:"10%",px:4,children:e.jsx(Fe,{colorScheme:y.data_pagamento?"green":"orange",children:y.data_pagamento?"Pago":"Pendente"})}),e.jsx(I,{width:"10%",px:4,justify:"flex-end",children:e.jsx(o,{isTruncated:!0,children:y.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})}),e.jsx(I,{width:"10%",px:4,justify:"flex-start",children:c&&e.jsxs(W,{spacing:2,children:[e.jsx(ne,{label:"Não é possível editar um registro de pagamento parcial",isDisabled:!y.discriminacao.startsWith("PAGAMENTO PARCIAL"),children:e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),size:"sm",onClick:()=>s(y),isDisabled:y.discriminacao.startsWith("PAGAMENTO PARCIAL")})}),e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),size:"sm",colorScheme:"red",onClick:()=>r(y.id)})]})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[e.jsxs(I,{bg:p,borderBottomWidth:"1px",fontWeight:"bold",role:"row",pr:"15px",children:[e.jsx(o,{width:"12%",p:4,children:"Data da Compra"}),e.jsx(o,{width:"12%",p:4,children:"Vencimento"}),e.jsx(o,{width:"31%",p:4,children:"Discriminação"}),e.jsx(o,{width:"15%",p:4,children:"Tipo"}),e.jsx(o,{width:"10%",p:4,children:"Status"}),e.jsx(o,{width:"10%",p:4,textAlign:"right",children:"Valor"}),e.jsx(o,{width:"10%",p:4,children:"Ações"})]}),i!=null&&i.dados&&i.dados.length>0?e.jsx(Ge,{height:500,itemCount:i.dados.length,itemSize:62,width:"100%",ref:d,children:D}):e.jsx(O,{p:10,children:e.jsx(o,{children:"Nenhuma despesa encontrada."})})]}),e.jsx(os,{paginaAtual:(i==null?void 0:i.pagina)||1,totalPaginas:(i==null?void 0:i.totalPaginas)||1,onPageChange:t})]})},sa=()=>{const{user:s}=Me(),r=(s==null?void 0:s.perfil)==="ADMIN",n=ze(),a=Se(),{isOpen:t,onOpen:l,onClose:c}=xe(),{isOpen:u,onOpen:d,onClose:i}=xe(),{isOpen:x,onOpen:f,onClose:p}=xe(),[S,R]=m.useState(null),[D,b]=m.useState(null),[L,y]=m.useState(null),F=m.useRef(null),[B,Q]=m.useState(""),U=us(B,500),[w,$]=m.useState(""),H=us(w,500),te=ee({mutationFn:Ft,onSuccess:(h,v)=>{const g=URL.createObjectURL(h);window.open(g,"_blank"),a({title:"PDF Gerado",description:`O comprovante da venda #${v} foi aberto em uma nova aba.`,status:"success",duration:4e3,isClosable:!0})},onError:h=>{var v,g;a({title:"Erro ao gerar PDF",description:((g=(v=h.response)==null?void 0:v.data)==null?void 0:g.error)||"Não foi possível gerar o comprovante.",status:"error"})}}),M=ee({mutationFn:Tt,onSuccess:()=>{n.invalidateQueries({queryKey:["vendas"]}),n.invalidateQueries({queryKey:["produtos"]}),a({title:"Venda excluída!",status:"success"}),p()},onError:h=>{var v,g;a({title:"Erro ao excluir venda",description:((g=(v=h.response)==null?void 0:v.data)==null?void 0:g.error)||h.message,status:"error"}),p()}}),de=ee({mutationFn:pt,onSuccess:()=>{n.invalidateQueries({queryKey:["despesas"]}),n.invalidateQueries({queryKey:["contasAPagar"]}),n.invalidateQueries({queryKey:["dashboardKPIs"]}),a({title:"Despesa excluída!",status:"success"}),p()},onError:h=>{var v,g;a({title:"Erro ao excluir despesa",description:((g=(v=h.response)==null?void 0:v.data)==null?void 0:g.error)||h.message,status:"error"}),p()}}),ce=h=>{R(h),l()},X=h=>{b(h),d()},ue=()=>{R(null),l()},le=()=>{b(null),d()},he=(h,v)=>{y({id:h,tipo:v}),f()},fe=h=>{a({title:"Gerando PDF...",description:"Por favor, aguarde.",status:"info",duration:2e3}),te.mutate(h)},P=()=>{L&&(L.tipo==="venda"?M.mutate(L.id):de.mutate(L.id))};return e.jsxs(C,{children:[e.jsxs(lr,{isFitted:!0,variant:"enclosed-colored",children:[e.jsxs(dr,{mb:"1em",children:[e.jsx(Ve,{children:"Vendas (Entradas)"}),r&&e.jsx(Ve,{children:"Despesas (Saídas)"})]}),e.jsxs(cr,{children:[e.jsxs(Ke,{children:[e.jsxs(I,{justify:"space-between",mb:4,direction:{base:"column",md:"row"},gap:4,children:[e.jsx(V,{size:"md",children:"Histórico de Vendas"}),e.jsx(k,{leftIcon:e.jsx(Xe,{}),colorScheme:"teal",onClick:ue,children:"Registrar Venda"})]}),e.jsx(C,{mb:6,children:e.jsxs(Qe,{children:[e.jsx(ts,{pointerEvents:"none",children:e.jsx(as,{color:"gray.300"})}),e.jsx(T,{placeholder:"Buscar por cliente ou vendedor...",value:B,onChange:h=>Q(h.target.value)})]})}),e.jsx(Xt,{onEdit:ce,onDelete:h=>he(h,"venda"),onGeneratePdf:fe,buscaDebounced:U})]}),r&&e.jsxs(Ke,{children:[e.jsxs(I,{justify:"space-between",mb:4,direction:{base:"column",md:"row"},gap:4,children:[e.jsx(V,{size:"md",children:"Histórico de Despesas"}),e.jsx(k,{leftIcon:e.jsx(Xe,{}),colorScheme:"red",onClick:le,children:"Registrar Despesa"})]}),e.jsx(C,{mb:6,children:e.jsxs(Qe,{children:[e.jsx(ts,{pointerEvents:"none",children:e.jsx(as,{color:"gray.300"})}),e.jsx(T,{placeholder:"Buscar por discriminação ou fornecedor...",value:w,onChange:h=>$(h.target.value)})]})}),e.jsx(ea,{onEdit:X,onDelete:h=>he(h,"despesa"),buscaDebounced:H})]})]})]}),e.jsx(Ut,{isOpen:t,onClose:c,vendaParaEditar:S}),r&&e.jsx(Jt,{isOpen:u,onClose:i,despesaParaEditar:D}),e.jsx(ms,{isOpen:x,leastDestructiveRef:F,onClose:p,children:e.jsx(me,{children:e.jsxs(js,{children:[e.jsx(je,{fontSize:"lg",fontWeight:"bold",children:"Confirmar Exclusão"}),e.jsx(pe,{children:"Tem certeza que deseja excluir este lançamento? Esta ação não pode ser desfeita."}),e.jsxs(ye,{children:[e.jsx(k,{ref:F,onClick:p,children:"Cancelar"}),e.jsx(k,{colorScheme:"red",onClick:P,ml:3,isLoading:M.isPending||de.isPending,children:"Sim, Excluir"})]})]})})})]})},ra=(s,r)=>{const[n,a]=m.useState(s);return m.useEffect(()=>{const t=setTimeout(()=>{a(s)},r);return()=>{clearTimeout(t)}},[s,r]),n},Cr=s=>{if(!s)return"";const r=s.replace(/\D/g,"");return r.length===11?`(${r.substring(0,2)}) ${r.substring(2,7)}-${r.substring(7)}`:r.length===10?`(${r.substring(0,2)}) ${r.substring(2,6)}-${r.substring(6)}`:s},Sr=s=>{const r=s.replace(/\D/g,"");window.open(`https://wa.me/55${r}`,"_blank")},na=({isOpen:s,onClose:r,cliente:n})=>{const{data:a,isLoading:t,isError:l}=re({queryKey:["historicoCliente",n==null?void 0:n.id],queryFn:()=>Ot(n.id),enabled:!!n&&s}),c=u=>e.jsx(En,{spacing:1,fontSize:"sm",children:u.map((d,i)=>e.jsxs(_n,{children:[e.jsxs(o,{as:"span",fontWeight:"bold",children:[d.quantidade," ",d.unidade_medida]})," - ",d.nome]},i))});return e.jsxs(ys,{isOpen:s,onClose:r,size:"4xl",scrollBehavior:"inside",children:[e.jsx(me,{}),e.jsxs(vs,{children:[e.jsxs(je,{children:["Histórico de Vendas de ",n==null?void 0:n.nome]}),e.jsx(Te,{}),e.jsxs(pe,{children:[t&&e.jsx(O,{p:10,children:e.jsx(ge,{size:"xl"})}),l&&e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Erro ao carregar o histórico."})}),!t&&!l&&e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"Data"}),e.jsx(N,{children:"Produtos"}),e.jsx(N,{children:"Status"}),e.jsx(N,{isNumeric:!0,children:"Valor"})]})}),e.jsx(Be,{children:a&&a.length>0?a.map(u=>e.jsxs(se,{children:[e.jsx(z,{children:new Date(u.data_venda).toLocaleDateString("pt-BR",{timeZone:"UTC"})}),e.jsx(z,{children:c(u.produtos)}),e.jsx(z,{children:e.jsx(Fe,{colorScheme:u.data_pagamento?"green":"red",children:u.data_pagamento?"Pago":"Pendente"})}),e.jsx(z,{isNumeric:!0,fontWeight:"bold",children:u.valor_total.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]},u.id)):e.jsx(se,{children:e.jsx(z,{colSpan:4,textAlign:"center",children:"Nenhuma venda encontrada."})})})]})})]})]})]})},ta=({isOpen:s,onClose:r,cliente:n,onSave:a})=>{var p,S,R,D;const{register:t,handleSubmit:l,reset:c,formState:{errors:u,isSubmitting:d}}=Oe(),i=ve({base:"full",md:"md"}),x=ve({base:"column",md:"row"});m.useEffect(()=>{s&&c(n||{nome:"",responsavel:"",telefone:"",tem_whatsapp:!1,endereco:"",email:""})},[n,s,c]);const f=b=>{a(b,n==null?void 0:n.id)};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:i,children:[e.jsx(me,{}),e.jsxs(ss,{children:[e.jsx(je,{borderBottomWidth:"1px",children:n?"Editar Cliente":"Cadastrar Novo Cliente"}),e.jsxs("form",{onSubmit:l(f),children:[e.jsx(pe,{children:e.jsxs(Ks,{spacing:4,children:[e.jsxs(I,{direction:x,gap:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!u.nome,flex:1,children:[e.jsx(A,{children:"Nome Empresarial"}),e.jsx(T,{...t("nome",{required:"Nome é obrigatório",validate:b=>b&&b.trim()!==""||"Não pode conter só espaços"}),textTransform:"uppercase"}),e.jsx(Z,{children:(p=u.nome)==null?void 0:p.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.responsavel,flex:1,children:[e.jsx(A,{children:"Responsável"}),e.jsx(T,{...t("responsavel",{required:"Responsável é obrigatório",validate:b=>b&&b.trim()!==""||"Não pode conter só espaços"}),textTransform:"uppercase"}),e.jsx(Z,{children:(S=u.responsavel)==null?void 0:S.message})]})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.telefone,children:[e.jsx(A,{children:"Telefone"}),e.jsx(T,{...t("telefone",{required:"Telefone é obrigatório",validate:b=>b&&b.trim()!==""||"Não pode conter só espaços"})}),e.jsx(Z,{children:(R=u.telefone)==null?void 0:R.message})]}),e.jsx(Pn,{...t("tem_whatsapp"),children:"É WhatsApp?"}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.endereco,children:[e.jsx(A,{children:"Endereço"}),e.jsx(T,{...t("endereco",{required:"Endereço é obrigatório",validate:b=>b&&b.trim()!==""||"Não pode conter só espaços"}),textTransform:"uppercase"}),e.jsx(Z,{children:(D=u.endereco)==null?void 0:D.message})]}),e.jsxs(q,{children:[e.jsx(A,{children:"Email (Opcional)"}),e.jsx(T,{type:"email",...t("email")})]})]})}),e.jsxs(ye,{borderTopWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"teal",type:"submit",isLoading:d,children:"Salvar"})]})]})]})]})},aa=()=>{const[s,r]=m.useState(1),[n,a]=m.useState(""),t=ra(n,500),{isOpen:l,onOpen:c,onClose:u}=xe(),{isOpen:d,onOpen:i,onClose:x}=xe(),{isOpen:f,onOpen:p,onClose:S}=xe(),[R,D]=m.useState(null),[b,L]=m.useState(null),[y,F]=m.useState(null),B=Se(),Q=ze(),{user:U}=Me(),w=(U==null?void 0:U.perfil)==="ADMIN",$=ve({base:!0,md:!1}),H=m.useRef(null),te=m.useRef(null);m.useEffect(()=>{t&&r(1)},[t]);const{data:M,isLoading:de,isError:ce}=re({queryKey:["clientes",s,t],queryFn:()=>sn(s,50,t),placeholderData:We});m.useEffect(()=>{te.current&&te.current.scrollTo(0)},[M]);const X=ee({mutationFn:({data:Y,id:G})=>G?It(G,Y):Lt(Y),onSuccess:()=>{Q.invalidateQueries({queryKey:["clientes"]}),B({title:"Cliente salvo!",status:"success"}),u()},onError:Y=>{var G,_;B({title:"Erro ao salvar.",description:((_=(G=Y.response)==null?void 0:G.data)==null?void 0:_.error)||Y.message,status:"error"})}}),ue=ee({mutationFn:Bt,onSuccess:()=>{Q.invalidateQueries({queryKey:["clientes"]}),B({title:"Cliente deletado!",status:"success"}),x()},onError:Y=>{var G,_;B({title:"Erro ao deletar.",description:((_=(G=Y.response)==null?void 0:G.data)==null?void 0:_.error)||Y.message,status:"error"})}}),le=Y=>{F(Y),c()},he=Y=>{L(Y),p()},fe=(Y,G)=>{X.mutate({data:Y,id:G})},P=Y=>{D(Y),i()},h=()=>{R&&ue.mutate(R.id)},v=j("gray.50","gray.700"),g=j("gray.100","gray.700"),E=j("gray.200","gray.600"),oe=({index:Y,style:G})=>{const _=M.dados[Y];return e.jsxs(I,{style:G,align:"center",_hover:{bg:g},borderBottomWidth:"1px",borderColor:E,children:[e.jsx(o,{width:"35%",px:4,isTruncated:!0,title:_.nome,children:_.nome}),e.jsx(I,{width:"30%",px:4,align:"center",children:e.jsx($e,{onClick:()=>_.tem_whatsapp&&Sr(_.telefone),color:_.tem_whatsapp?"teal.500":"inherit",_hover:{textDecoration:"none"},children:e.jsxs(W,{children:[e.jsx(De,{as:_.tem_whatsapp?bs:jr}),e.jsx(o,{children:Cr(_.telefone)})]})})}),e.jsx(o,{width:"25%",px:4,isTruncated:!0,children:_.endereco}),e.jsx(I,{width:"10%",px:4,justify:"flex-start",children:e.jsxs(W,{children:[e.jsx(ne,{label:"Histórico de Vendas",hasArrow:!0,children:e.jsx(K,{"aria-label":"Histórico",icon:e.jsx(mr,{}),onClick:()=>he(_)})}),e.jsx(ne,{label:"Editar Cliente",hasArrow:!0,children:e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),onClick:()=>le(_)})}),w&&e.jsx(ne,{label:"Excluir Cliente",hasArrow:!0,children:e.jsx(K,{"aria-label":"Deletar",icon:e.jsx(Re,{}),colorScheme:"red",onClick:()=>P(_)})})]})})]})},be=({index:Y,style:G})=>{const _=M.dados[Y];return e.jsx(C,{style:G,px:2,py:2,children:e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",boxShadow:"sm",children:[e.jsxs(I,{justify:"space-between",align:"center",children:[e.jsx(V,{size:"sm",noOfLines:1,children:_.nome}),e.jsxs(W,{spacing:1,children:[e.jsx(K,{"aria-label":"Histórico",icon:e.jsx(mr,{}),size:"sm",onClick:()=>he(_)}),e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),size:"sm",onClick:()=>le(_)}),w&&e.jsx(K,{"aria-label":"Deletar",icon:e.jsx(Re,{}),colorScheme:"red",size:"sm",onClick:()=>P(_)})]})]}),e.jsx(Ue,{my:2}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Contato:"}),e.jsxs(W,{as:$e,onClick:()=>_.tem_whatsapp&&Sr(_.telefone),color:_.tem_whatsapp?"teal.500":"inherit",_hover:{textDecoration:"none"},children:[e.jsx(De,{as:_.tem_whatsapp?bs:jr}),e.jsx(o,{children:Cr(_.telefone)})]})]}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Endereço:"}),e.jsx(o,{noOfLines:1,textAlign:"right",children:_.endereco||"Não informado"})]})]})})};return e.jsxs(C,{p:{base:2,md:8},children:[e.jsxs(I,{justify:"space-between",align:"center",mb:6,direction:{base:"column",md:"row"},gap:4,children:[e.jsxs(C,{textAlign:{base:"center",md:"left"},children:[e.jsx(V,{children:"Gestão de Clientes"}),e.jsx(o,{color:"gray.500",children:"Adicione, edite e gerencie seus clientes."})]}),e.jsx(k,{leftIcon:e.jsx(Xe,{}),colorScheme:"teal",onClick:()=>le(null),w:{base:"full",md:"auto"},children:"Novo Cliente"})]}),e.jsx(C,{mb:6,children:e.jsxs(Qe,{children:[e.jsx(ts,{pointerEvents:"none",children:e.jsx(as,{color:"gray.300"})}),e.jsx(T,{placeholder:"Buscar por nome, email, telefone ou responsável...",value:n,onChange:Y=>a(Y.target.value)})]})}),de?e.jsx(O,{p:10,children:e.jsx(ge,{size:"xl"})}):ce?e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Não foi possível carregar os clientes."})}):!(M!=null&&M.dados)||M.dados.length===0?e.jsx(O,{p:10,children:e.jsx(o,{children:"Nenhum cliente encontrado."})}):e.jsxs(e.Fragment,{children:[$?e.jsx(Ge,{height:600,itemCount:M.dados.length,itemSize:155,width:"100%",ref:te,children:be}):e.jsxs(C,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[e.jsxs(I,{bg:v,borderBottomWidth:"1px",fontWeight:"bold",role:"row",pr:"15px",children:[e.jsx(o,{width:"35%",p:4,children:"Nome Empresarial"}),e.jsx(o,{width:"30%",p:4,children:"Contato"}),e.jsx(o,{width:"25%",p:4,children:"Endereço Principal"}),e.jsx(o,{width:"10%",p:4,children:"Ações"})]}),e.jsx(Ge,{height:600,itemCount:M.dados.length,itemSize:62,width:"100%",ref:te,children:oe})]}),e.jsx(os,{paginaAtual:(M==null?void 0:M.pagina)||1,totalPaginas:(M==null?void 0:M.totalPaginas)||1,onPageChange:Y=>r(Y)})]}),e.jsx(ta,{isOpen:l,onClose:u,cliente:y,onSave:fe}),e.jsx(na,{isOpen:f,onClose:S,cliente:b}),e.jsx(ms,{isOpen:d,leastDestructiveRef:H,onClose:x,children:e.jsx(me,{children:e.jsxs(js,{children:[e.jsx(je,{fontSize:"lg",fontWeight:"bold",children:"Confirmar Exclusão"}),e.jsxs(pe,{children:["Tem certeza que deseja excluir o cliente ",e.jsx("strong",{children:R==null?void 0:R.nome}),"? Esta ação não pode ser desfeita."]}),e.jsxs(ye,{children:[e.jsx(k,{ref:H,onClick:x,children:"Cancelar"}),e.jsx(k,{colorScheme:"red",onClick:h,ml:3,isLoading:ue.isPending,children:"Sim, Excluir"})]})]})})})]})},oa=({isOpen:s,onClose:r,onSubmit:n,produto:a,isLoading:t})=>{var x,f,p;const{register:l,handleSubmit:c,formState:{errors:u},reset:d}=Oe();m.useEffect(()=>{s&&d({data_entrada:new Date().toISOString().split("T")[0],quantidade_adicionada:void 0,custo_total:void 0,observacao:""})},[s,d]);const i=S=>{n({...S,quantidade_adicionada:Number(S.quantidade_adicionada),custo_total:Number(S.custo_total)})};return e.jsxs(ys,{isOpen:s,onClose:r,isCentered:!0,children:[e.jsx(me,{}),e.jsx(vs,{children:e.jsxs("form",{onSubmit:c(i),children:[e.jsx(je,{children:"Registrar Entrada de Estoque"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(o,{alignSelf:"flex-start",children:["Você está adicionando estoque para o produto: ",e.jsx("strong",{children:a==null?void 0:a.nome})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.data_entrada,children:[e.jsx(A,{children:"Data da Entrada"}),e.jsx(T,{type:"date",...l("data_entrada",{required:"A data é obrigatória"})}),e.jsx(Z,{children:(x=u.data_entrada)==null?void 0:x.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.quantidade_adicionada,children:[e.jsxs(A,{children:["Quantidade Adicionada (",a==null?void 0:a.unidade_medida,")"]}),e.jsx(ks,{min:.001,precision:3,children:e.jsx(zs,{...l("quantidade_adicionada",{required:"Quantidade é obrigatória",valueAsNumber:!0,min:{value:.001,message:"A quantidade deve ser maior que zero."}})})}),e.jsx(Z,{children:(f=u.quantidade_adicionada)==null?void 0:f.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.custo_total,children:[e.jsx(A,{children:"Custo Total da Entrada (R$)"}),e.jsx(ks,{min:0,precision:2,children:e.jsx(zs,{...l("custo_total",{required:"Custo total é obrigatório",valueAsNumber:!0,min:{value:0,message:"O custo não pode ser negativo."}})})}),e.jsx(Z,{children:(p=u.custo_total)==null?void 0:p.message})]}),e.jsxs(q,{children:[e.jsx(A,{children:"Observação (Opcional)"}),e.jsx(ir,{placeholder:"Ex: Nota fiscal 123, Fornecedor Sítio do Picapau",...l("observacao")})]})]})}),e.jsxs(ye,{children:[e.jsx(k,{variant:"ghost",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"blue",type:"submit",isLoading:t,children:"Adicionar ao Estoque"})]})]})})]})},ia=({isOpen:s,onClose:r,produto:n,onSave:a,isLoading:t})=>{var S,R;const{register:l,handleSubmit:c,reset:u,watch:d,formState:{errors:i}}=Oe(),x=d("unidade_medida"),f=ve({base:"full",md:"md"});m.useEffect(()=>{if(s)if(n){const b=["UN","KG"].includes(n.unidade_medida.toUpperCase());u({nome:n.nome,price:n.price,unidade_medida:b?n.unidade_medida.toUpperCase():"OUTROS",outra_unidade_medida:b?"":n.unidade_medida})}else u({nome:"",price:void 0,unidade_medida:"UN",outra_unidade_medida:""})},[s,n,u]);const p=D=>{const b={nome:D.nome,price:D.price,unidade_medida:D.unidade_medida==="OUTROS"&&D.outra_unidade_medida?D.outra_unidade_medida:D.unidade_medida};a(b)};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:f,children:[e.jsx(me,{}),e.jsxs(ss,{as:"form",onSubmit:c(p),children:[e.jsx(je,{borderBottomWidth:"1px",children:n?"Editar Produto":"Criar Novo Produto"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!i.nome,children:[e.jsx(A,{children:"Nome do Produto"}),e.jsx(T,{placeholder:"Informe o nome do produto",textTransform:"uppercase",...l("nome",{required:"Nome é obrigatório",validate:D=>D&&D.trim()!==""||"Não pode conter só espaços"})}),e.jsx(Z,{children:(S=i.nome)==null?void 0:S.message})]}),e.jsxs(q,{isInvalid:!!i.unidade_medida,children:[e.jsx(A,{children:"Unidade de Medida"}),e.jsxs(Je,{...l("unidade_medida",{required:"Unidade é obrigatória"}),children:[e.jsx("option",{value:"UN",children:"Unidade (UN)"}),e.jsx("option",{value:"KG",children:"Quilo (KG)"}),e.jsx("option",{value:"OUTROS",children:"Outros"})]})]}),x==="OUTROS"&&e.jsxs(q,{isInvalid:!!i.outra_unidade_medida,children:[e.jsx(A,{children:"Especifique a Unidade"}),e.jsx(T,{textTransform:"uppercase",...l("outra_unidade_medida",{required:x==="OUTROS"})})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!i.price,children:[e.jsx(A,{children:"Preço (R$)"}),e.jsx(T,{placeholder:"Ex: 85.50",type:"text",inputMode:"decimal",...l("price",{required:"Preço é obrigatório",valueAsNumber:!0,validate:{isNumber:D=>!isNaN(parseFloat(String(D))),isPositive:D=>parseFloat(String(D))>=0}})}),e.jsx(Z,{children:(R=i.price)==null?void 0:R.message})]})]})}),e.jsxs(ye,{borderTopWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"teal",type:"submit",isLoading:t,children:"Salvar"})]})]})]})},la=()=>{const{isOpen:s,onOpen:r,onClose:n}=xe(),{isOpen:a,onOpen:t,onClose:l}=xe(),{isOpen:c,onOpen:u,onClose:d}=xe(),i=Se(),{user:x}=Me(),f=ze(),[p,S]=m.useState(1),[R,D]=m.useState(""),b=us(R,500),[L,y]=m.useState(null),[F,B]=m.useState(null),[Q,U]=m.useState(null),w=m.useRef(null),$=m.useRef(null),H=(x==null?void 0:x.perfil)==="ADMIN",te=ve({base:!0,md:!1});m.useEffect(()=>{b&&S(1)},[b]);const{data:M,isLoading:de,isError:ce}=re({queryKey:["produtos",p,b],queryFn:()=>rn(p,50,b),placeholderData:We});m.useEffect(()=>{$.current&&$.current.scrollTo(0)},[M]);const X=ee({mutationFn:_=>L!=null&&L.id?Wt(L.id,_):$t(_),onSuccess:()=>{i({title:"Produto salvo!",status:"success"}),n(),f.invalidateQueries({queryKey:["produtos"]})},onError:_=>{var Ce,J;i({title:"Erro ao salvar.",description:((J=(Ce=_.response)==null?void 0:Ce.data)==null?void 0:J.msg)||"Ocorreu um erro",status:"error"})}}),ue=ee({mutationFn:Vt,onSuccess:()=>{i({title:"Produto deletado!",status:"success"}),d(),f.invalidateQueries({queryKey:["produtos"]})},onError:_=>{var Ce,J;i({title:"Erro ao deletar.",description:((J=(Ce=_.response)==null?void 0:Ce.data)==null?void 0:J.msg)||"Ocorreu um erro",status:"error"})}}),le=ee({mutationFn:({id:_,data:Ce})=>Kt({id:_,data:Ce}),onSuccess:()=>{i({title:"Estoque atualizado!",status:"success"}),l(),f.invalidateQueries({queryKey:["produtos"]})},onError:_=>{var Ce,J;i({title:"Erro ao adicionar estoque.",description:((J=(Ce=_.response)==null?void 0:Ce.data)==null?void 0:J.error)||"Ocorreu um erro",status:"error"})}}),he=_=>{X.mutate(_)},fe=_=>{U(_),u()},P=()=>{Q&&ue.mutate(Q.id)},h=()=>{y(null),r()},v=_=>{y(_),r()},g=_=>{B(_),t()},E=j("gray.50","gray.700"),oe=j("gray.100","gray.700"),be=j("gray.200","gray.600"),Y=({index:_,style:Ce})=>{const J=M.dados[_];return e.jsxs(I,{style:Ce,align:"center",_hover:{bg:oe},borderBottomWidth:"1px",borderColor:be,children:[e.jsx(o,{width:"40%",px:4,isTruncated:!0,title:J.nome,children:J.nome}),e.jsx(o,{width:"15%",px:4,textAlign:"center",children:J.unidade_medida}),e.jsx(o,{width:"15%",px:4,textAlign:"center",children:J.price.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx(o,{width:"15%",px:4,textAlign:"center",children:J.quantidade_em_estoque.toFixed(2)}),H&&e.jsx(I,{width:"15%",px:4,justify:"center",children:e.jsxs(W,{spacing:2,children:[e.jsx(ne,{label:"Registrar Entrada",hasArrow:!0,children:e.jsx(K,{"aria-label":"Entrada de Estoque",icon:e.jsx(pr,{}),size:"sm",colorScheme:"blue",onClick:()=>g(J)})}),e.jsx(ne,{label:"Editar Produto",hasArrow:!0,children:e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),size:"sm",onClick:()=>v(J)})}),e.jsx(ne,{label:"Excluir Produto",hasArrow:!0,children:e.jsx(K,{"aria-label":"Deletar",icon:e.jsx(Re,{}),size:"sm",colorScheme:"red",onClick:()=>fe(J)})})]})})]})},G=({index:_,style:Ce})=>{const J=M.dados[_];return e.jsx(C,{style:Ce,px:2,py:2,children:e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",boxShadow:"sm",children:[e.jsxs(I,{justify:"space-between",align:"center",children:[e.jsx(V,{size:"sm",noOfLines:1,children:J.nome}),e.jsx(o,{fontWeight:"bold",color:"teal.500",children:J.price.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})})]}),e.jsx(Ue,{my:2}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Unidade:"}),e.jsx(o,{fontWeight:"bold",children:J.unidade_medida.toUpperCase()})]}),e.jsxs(W,{justify:"space-between",mt:1,children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Estoque:"}),e.jsxs(o,{fontWeight:"bold",children:[J.quantidade_em_estoque.toFixed(2)," ",J.unidade_medida]})]}),H&&e.jsxs(W,{mt:4,justify:"space-around",bg:j("gray.100","gray.700"),p:2,borderRadius:"md",children:[e.jsx(k,{flex:"1",size:"sm",leftIcon:e.jsx(pr,{}),colorScheme:"blue",onClick:()=>g(J),children:"Estoque"}),e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),onClick:()=>v(J)}),e.jsx(K,{"aria-label":"Deletar",icon:e.jsx(Re,{}),colorScheme:"red",onClick:()=>fe(J)})]})]})})};return e.jsxs(C,{p:{base:2,md:8},children:[e.jsxs(I,{justify:"space-between",align:"center",mb:6,direction:{base:"column",md:"row"},gap:4,children:[e.jsxs(C,{textAlign:{base:"center",md:"left"},children:[e.jsx(V,{children:"Gestão de Produtos"}),e.jsx(o,{color:"gray.500",children:"Adicione, edite e controle o estoque dos seus produtos."})]}),H&&e.jsx(k,{leftIcon:e.jsx(Xe,{}),colorScheme:"teal",onClick:h,w:{base:"full",md:"auto"},children:"Novo Produto"})]}),e.jsx(C,{mb:6,children:e.jsxs(Qe,{children:[e.jsx(ts,{pointerEvents:"none",children:e.jsx(as,{color:"gray.300"})}),e.jsx(T,{placeholder:"Buscar por nome do produto...",value:R,onChange:_=>D(_.target.value)})]})}),de?e.jsx(O,{p:10,children:e.jsx(ge,{size:"xl"})}):ce?e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Não foi possível carregar os produtos."})}):!(M!=null&&M.dados)||M.dados.length===0?e.jsx(O,{p:10,children:e.jsx(o,{children:"Nenhum produto encontrado."})}):e.jsxs(e.Fragment,{children:[te?e.jsx(Ge,{height:600,itemCount:M.dados.length,itemSize:175,width:"100%",ref:$,children:G}):e.jsxs(C,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[e.jsxs(I,{bg:E,borderBottomWidth:"1px",fontWeight:"bold",role:"row",pr:"15px",children:[e.jsx(o,{width:"40%",p:4,children:"Nome"}),e.jsx(o,{width:"15%",p:4,textAlign:"center",children:"Unidade"}),e.jsx(o,{width:"15%",p:4,textAlign:"center",children:"Preço"}),e.jsx(o,{width:"15%",p:4,textAlign:"center",children:"Estoque"}),H&&e.jsx(o,{width:"15%",p:4,textAlign:"center",children:"Ações"})]}),e.jsx(Ge,{height:600,itemCount:M.dados.length,itemSize:62,width:"100%",ref:$,children:Y})]}),e.jsx(os,{paginaAtual:(M==null?void 0:M.pagina)||1,totalPaginas:(M==null?void 0:M.totalPaginas)||1,onPageChange:S})]}),e.jsx(ia,{isOpen:s,onClose:n,produto:L,onSave:he,isLoading:X.isPending}),e.jsx(oa,{isOpen:a,onClose:l,produto:F,onSubmit:_=>F&&le.mutate({id:F.id,data:_}),isLoading:le.isPending}),e.jsx(ms,{isOpen:c,leastDestructiveRef:w,onClose:d,children:e.jsx(me,{children:e.jsxs(js,{children:[e.jsx(je,{fontSize:"lg",fontWeight:"bold",children:"Confirmar Exclusão"}),e.jsxs(pe,{children:["Tem certeza que deseja excluir o produto ",e.jsx("strong",{children:Q==null?void 0:Q.nome}),"? Esta ação não pode ser desfeita e pode afetar relatórios de vendas antigos."]}),e.jsxs(ye,{children:[e.jsx(k,{ref:w,onClick:d,children:"Cancelar"}),e.jsx(k,{colorScheme:"red",onClick:P,ml:3,isLoading:ue.isPending,children:"Sim, Excluir"})]})]})})})]})},Gs=s=>{if(!s)return"";const r=s.replace(/\D/g,"");return r.length<=11?r.replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"):r.slice(0,14).replace(/(\d{2})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1/$2").replace(/(\d{4})(\d{1,2})$/,"$1-$2")},da=s=>{if(!s)return"Campo obrigatório";const r=s.replace(/\D/g,"");return r.length!==11&&r.length!==14?"O CNPJ/CPF deve ter 11 ou 14 dígitos.":!0},ca=({isOpen:s,onClose:r,fornecedor:n,onSave:a,isLoading:t})=>{var p,S,R,D;const{register:l,handleSubmit:c,reset:u,formState:{errors:d},control:i}=Oe(),x=ve({base:"full",md:"md"});m.useEffect(()=>{if(s)if(n){const b={...n,cnpj_cpf:Gs(n.cnpj_cpf||"")};u(b)}else u({nome:"",cnpj_cpf:"",telefone:"",email:"",endereco:""})},[n,s,u]);const f=b=>{a(b,n==null?void 0:n.id)};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:x,children:[e.jsx(me,{}),e.jsx(ss,{children:e.jsxs("form",{onSubmit:c(f),children:[e.jsx(je,{borderBottomWidth:"1px",children:n?"Editar Fornecedor":"Adicionar Novo Fornecedor"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!d.nome,children:[e.jsx(A,{children:"Nome"}),e.jsx(T,{...l("nome",{required:"Nome é obrigatório",validate:b=>b&&b.trim()!==""||"O campo nome não pode conter apenas espaços"}),textTransform:"uppercase"}),e.jsx(Z,{children:(p=d.nome)==null?void 0:p.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.cnpj_cpf,children:[e.jsx(A,{children:"CNPJ/CPF"}),e.jsx(or,{name:"cnpj_cpf",control:i,rules:{validate:da},render:({field:{onChange:b,value:L,name:y}})=>e.jsx(T,{name:y,value:L||"",onChange:F=>b(Gs(F.target.value)),placeholder:"Digite o CNPJ ou CPF"})}),e.jsx(Z,{children:(S=d.cnpj_cpf)==null?void 0:S.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.telefone,children:[e.jsx(A,{children:"Telefone"}),e.jsx(T,{...l("telefone",{required:"Telefone é obrigatório"})}),e.jsx(Z,{children:(R=d.telefone)==null?void 0:R.message})]}),e.jsxs(q,{isInvalid:!!d.email,children:[e.jsx(A,{children:"Email"}),e.jsx(T,{type:"email",...l("email")})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.endereco,children:[e.jsx(A,{children:"Endereço"}),e.jsx(T,{...l("endereco",{required:"Endereço é obrigatório"}),textTransform:"uppercase"}),e.jsx(Z,{children:(D=d.endereco)==null?void 0:D.message})]})]})}),e.jsxs(ye,{borderBottomWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"teal",type:"submit",isLoading:t,children:"Salvar"})]})]})})]})},ua=()=>{const{user:s}=Me(),r=ze(),n=Se(),{isOpen:a,onOpen:t,onClose:l}=xe(),{isOpen:c,onOpen:u,onClose:d}=xe(),[i,x]=m.useState(null),[f,p]=m.useState(1),[S,R]=m.useState(""),D=us(S,500),b=ve({base:!0,md:!1}),L=m.useRef(null),y=m.useRef(null),F=(s==null?void 0:s.perfil)==="ADMIN";m.useEffect(()=>{D&&p(1)},[D]);const{data:B,isLoading:Q,isError:U}=re({queryKey:["fornecedores",f,D],queryFn:()=>nn(f,50,D),placeholderData:We});m.useEffect(()=>{y.current&&y.current.scrollTo(0)},[B]);const w=ee({mutationFn:({data:P,id:h})=>h?Ht({id:h,...P}):Gt(P),onSuccess:()=>{r.invalidateQueries({queryKey:["fornecedores"]}),n({title:"Fornecedor salvo com sucesso!",status:"success"}),l()},onError:P=>{var h,v;n({title:"Erro ao salvar fornecedor",description:((v=(h=P.response)==null?void 0:h.data)==null?void 0:v.error)||P.message,status:"error"})}}),$=ee({mutationFn:Zt,onSuccess:()=>{r.invalidateQueries({queryKey:["fornecedores"]}),n({title:"Fornecedor excluído com sucesso!",status:"success"}),d()},onError:P=>{var h,v;n({title:"Erro ao excluir fornecedor",description:((v=(h=P.response)==null?void 0:h.data)==null?void 0:v.error)||P.message,status:"error"})}}),H=()=>{x(null),t()},te=P=>{x(P),t()},M=P=>{x(P),u()},de=()=>{i&&$.mutate(i.id)},ce=(P,h)=>{w.mutate({data:P,id:h})},X=j("gray.50","gray.700"),ue=j("gray.100","gray.700"),le=j("gray.200","gray.600"),he=({index:P,style:h})=>{const v=B.dados[P];return e.jsxs(I,{style:h,align:"center",_hover:{bg:ue},borderBottomWidth:"1px",borderColor:le,children:[e.jsx(o,{width:"30%",px:4,isTruncated:!0,title:v.nome,children:v.nome}),e.jsx(o,{width:"20%",px:4,isTruncated:!0,children:Gs(v.cnpj_cpf||"")}),e.jsx(o,{width:"25%",px:4,isTruncated:!0,children:v.telefone||"---"}),e.jsx(o,{width:"25%",px:4,isTruncated:!0,children:v.email||"---"}),e.jsx(I,{width:"10%",px:4,justify:"flex-start",children:e.jsxs(W,{children:[e.jsx(ne,{label:"Editar Fornecedor",hasArrow:!0,children:e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),onClick:()=>te(v)})}),F&&e.jsx(ne,{label:"Excluir Fornecedor",hasArrow:!0,children:e.jsx(K,{"aria-label":"Deletar",icon:e.jsx(Re,{}),colorScheme:"red",onClick:()=>M(v)})})]})})]})},fe=({index:P,style:h})=>{const v=B.dados[P];return e.jsx(C,{style:h,px:2,py:2,children:e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",boxShadow:"sm",children:[e.jsxs(I,{justify:"space-between",align:"center",children:[e.jsx(V,{size:"sm",noOfLines:1,children:v.nome}),e.jsxs(W,{spacing:1,children:[e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),size:"sm",onClick:()=>te(v)}),F&&e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),colorScheme:"red",size:"sm",onClick:()=>M(v)})]})]}),e.jsx(Ue,{my:2}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"CNPJ/CPF:"}),e.jsx(o,{children:Gs(v.cnpj_cpf||"")||"Não informado"})]}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Telefone:"}),e.jsx(o,{children:v.telefone||"Não informado"})]})]})})};return e.jsxs(C,{p:{base:4,md:8},children:[e.jsxs(I,{justify:"space-between",align:"center",mb:6,direction:{base:"column",md:"row"},gap:4,children:[e.jsx(V,{textAlign:{base:"center",md:"left"},children:"Gestão de Fornecedores"}),e.jsx(k,{leftIcon:e.jsx(Xe,{}),colorScheme:"teal",onClick:H,w:{base:"full",md:"auto"},children:"Adicionar Fornecedor"})]}),e.jsx(C,{mb:6,children:e.jsxs(Qe,{children:[e.jsx(ts,{pointerEvents:"none",children:e.jsx(as,{color:"gray.300"})}),e.jsx(T,{placeholder:"Buscar por nome, CNPJ/CPF, telefone ou email...",value:S,onChange:P=>R(P.target.value)})]})}),Q?e.jsx(O,{p:10,children:e.jsx(ge,{size:"xl"})}):U?e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Não foi possível carregar os fornecedores."})}):!(B!=null&&B.dados)||B.dados.length===0?e.jsx(O,{p:10,children:e.jsx(o,{children:"Nenhum fornecedor encontrado."})}):e.jsxs(e.Fragment,{children:[b?e.jsx(Ge,{height:600,itemCount:B.dados.length,itemSize:145,width:"100%",ref:y,children:fe}):e.jsxs(C,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[e.jsxs(I,{bg:X,borderBottomWidth:"1px",fontWeight:"bold",role:"row",pr:"15px",children:[e.jsx(o,{width:"30%",p:4,children:"Nome"}),e.jsx(o,{width:"20%",p:4,children:"CNPJ/CPF"}),e.jsx(o,{width:"25%",p:4,children:"Telefone"}),e.jsx(o,{width:"25%",p:4,children:"Email"}),e.jsx(o,{width:"10%",p:4,children:"Ações"})]}),e.jsx(Ge,{height:600,itemCount:B.dados.length,itemSize:62,width:"100%",ref:y,children:he})]}),B&&B.totalPaginas>1&&e.jsx(os,{paginaAtual:B.pagina||1,totalPaginas:B.totalPaginas||1,onPageChange:p})]}),e.jsxs(ys,{isOpen:c,onClose:d,isCentered:!0,children:[e.jsx(me,{}),e.jsxs(vs,{children:[e.jsx(je,{children:"Confirmar Exclusão"}),e.jsx(Te,{}),e.jsxs(pe,{children:[e.jsxs(o,{children:["Tem certeza que deseja excluir o fornecedor ",e.jsx("strong",{children:i==null?void 0:i.nome}),"?"]}),e.jsx(o,{fontSize:"sm",color:"red.500",mt:2,children:"Atenção: Esta ação não pode ser desfeita."})]}),e.jsxs(ye,{children:[e.jsx(k,{variant:"ghost",mr:3,onClick:d,ref:L,children:"Cancelar"}),e.jsx(k,{colorScheme:"red",onClick:de,isLoading:$.isPending,children:"Sim, Excluir"})]})]})]}),a&&e.jsx(ca,{isOpen:a,onClose:l,fornecedor:i,onSave:ce,isLoading:w.isPending})]})},ha=({isOpen:s,onClose:r})=>{var p,S,R,D,b,L;const n=ze(),a=Se(),{register:t,handleSubmit:l,reset:c,formState:{errors:u,isSubmitting:d}}=Oe(),i=ve({base:"full",md:"md"}),x=ee({mutationFn:Rt,onSuccess:()=>{n.invalidateQueries({queryKey:["utilizadores"]}),a({title:"Utilizador criado com sucesso!",status:"success",duration:3e3,isClosable:!0}),r()},onError:y=>{var F,B;a({title:"Erro ao criar utilizador",description:((B=(F=y.response)==null?void 0:F.data)==null?void 0:B.error)||y.message,status:"error",duration:5e3,isClosable:!0})}});m.useEffect(()=>{s||c()},[s,c]);const f=y=>{x.mutate(y)};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:i,children:[e.jsx(me,{}),e.jsx(ss,{children:e.jsxs("form",{onSubmit:l(f),children:[e.jsx(je,{borderBottomWidth:"1px",children:"Adicionar Novo Utilizador"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!u.nome,children:[e.jsx(A,{children:"Nome Completo"}),e.jsx(T,{...t("nome",{required:"Nome é obrigatório"}),textTransform:"uppercase"}),e.jsx(Z,{children:(p=u.nome)==null?void 0:p.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.email,children:[e.jsx(A,{children:"Email"}),e.jsx(T,{type:"email",...t("email",{required:"Email é obrigatório"})}),e.jsx(Z,{children:(S=u.email)==null?void 0:S.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.telefone,children:[e.jsx(A,{children:"Telefone"}),e.jsx(T,{...t("telefone",{required:"Telefone é obrigatório"})}),e.jsx(Z,{children:(R=u.telefone)==null?void 0:R.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.nickname,children:[e.jsx(A,{children:"Nickname (Apelido)"}),e.jsx(T,{...t("nickname",{required:"Nickname é obrigatório"}),textTransform:"uppercase"}),e.jsx(Z,{children:(D=u.nickname)==null?void 0:D.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.senha,children:[e.jsx(A,{children:"Senha Provisória"}),e.jsx(T,{type:"password",...t("senha",{required:"Senha é obrigatória",minLength:{value:6,message:"A senha deve ter no mínimo 6 caracteres"}})}),e.jsx(Z,{children:(b=u.senha)==null?void 0:b.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!u.perfil,children:[e.jsx(A,{children:"Perfil"}),e.jsxs(Je,{placeholder:"Selecione um perfil",...t("perfil",{required:"Perfil é obrigatório"}),children:[e.jsx("option",{value:"VENDEDOR",children:"Vendedor"}),e.jsx("option",{value:"GERENTE",children:"Gerente"}),e.jsx("option",{value:"ADMINISTRATIVO",children:"Administrativo"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]}),e.jsx(Z,{children:(L=u.perfil)==null?void 0:L.message})]})]})}),e.jsxs(ye,{borderBottomWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"teal",type:"submit",isLoading:d,children:"Salvar Utilizador"})]})]})})]})},xa=({isOpen:s,onClose:r,utilizador:n})=>{const a=ze(),t=Se(),{register:l,handleSubmit:c,setValue:u,formState:{errors:d,isSubmitting:i}}=Oe(),x=ve({base:"full",md:"md"});m.useEffect(()=>{n&&(u("nome",n.nome),u("email",n.email),u("telefone",n.telefone),u("nickname",n.nickname),n.perfil!=="PENDENTE"&&u("perfil",n.perfil),u("status",n.status))},[n,u]);const f=ee({mutationFn:S=>en({id:n.id,data:S}),onSuccess:()=>{a.invalidateQueries({queryKey:["utilizadores"]}),t({title:"Utilizador atualizado!",status:"success",duration:3e3,isClosable:!0}),r()},onError:S=>{var R,D;t({title:"Erro ao atualizar",description:((D=(R=S.response)==null?void 0:R.data)==null?void 0:D.error)||S.message,status:"error",duration:5e3,isClosable:!0})}}),p=S=>{f.mutate(S)};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:x,children:[e.jsx(me,{}),e.jsx(ss,{children:e.jsxs("form",{onSubmit:c(p),children:[e.jsx(je,{borderBottomWidth:"1px",children:"Editar Utilizador"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!d.nome,children:[e.jsx(A,{children:"Nome Completo"}),e.jsx(T,{...l("nome",{required:"Nome é obrigatório"}),textTransform:"uppercase"})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.email,children:[e.jsx(A,{children:"Email"}),e.jsx(T,{type:"email",...l("email",{required:"Email é obrigatório"})})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.telefone,children:[e.jsx(A,{children:"Telefone"}),e.jsx(T,{...l("telefone",{required:"Telefone é obrigatório"})})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.nickname,children:[e.jsx(A,{children:"Nickname"}),e.jsx(T,{...l("nickname",{required:"Nickname é obrigatório"}),textTransform:"uppercase"})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.perfil,children:[e.jsx(A,{children:"Perfil"}),e.jsxs(Je,{placeholder:"Selecione",...l("perfil",{required:"Perfil é obrigatório"}),children:[e.jsx("option",{value:"VENDEDOR",children:"Vendedor"}),e.jsx("option",{value:"GERENTE",children:"Gerente"}),e.jsx("option",{value:"ADMINISTRATIVO",children:"Administrativo"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]})]})}),e.jsxs(ye,{borderBottomWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"teal",type:"submit",isLoading:i,children:"Salvar Alterações"})]})]})})]})},ma=()=>{const{user:s}=Me(),r=ze(),n=Se(),{isOpen:a,onOpen:t,onClose:l}=xe(),{isOpen:c,onOpen:u,onClose:d}=xe(),{isOpen:i,onOpen:x,onClose:f}=xe(),[p,S]=m.useState(null),[R,D]=m.useState(1),[b,L]=m.useState(""),y=us(b,500),F=m.useRef(null),B=ve({base:!0,md:!1}),Q=m.useRef(null),U=j("gray.100","gray.700");m.useEffect(()=>{y&&D(1)},[y]);const{data:w,isLoading:$,isError:H}=re({queryKey:["utilizadores",R,y],queryFn:()=>Xr(R,10,y),placeholderData:We});m.useEffect(()=>{Q.current&&Q.current.scrollTo(0)},[w]);const te=ee({mutationFn:v=>en({id:v.id,data:{...v,perfil:v.perfil==="PENDENTE"?"VENDEDOR":v.perfil,status:v.status==="ATIVO"?"INATIVO":"ATIVO"}}),onSuccess:()=>{r.invalidateQueries({queryKey:["utilizadores"]}),n({title:"Status atualizado!",status:"info",duration:2e3,isClosable:!0})},onError:v=>{n({title:"Erro ao atualizar status",description:v.message,status:"error"})}}),M=ee({mutationFn:Et,onSuccess:()=>{r.invalidateQueries({queryKey:["utilizadores"]}),n({title:"Utilizador excluído!",status:"success"}),f()},onError:v=>{n({title:"Erro ao excluir",description:v.message,status:"error"})}}),de=v=>{S(v),t()},ce=v=>{S(v),x()},X=()=>{p&&M.mutate(p.id)},ue=(v,g)=>g==="PENDENTE"?e.jsx(Ys,{colorScheme:"yellow",children:"Pendente"}):v==="ATIVO"?e.jsx(Ys,{colorScheme:"green",children:"Ativo"}):e.jsx(Ys,{colorScheme:"red",children:"Inativo"}),le=j("gray.50","gray.700"),he=j("gray.100","gray.700"),fe=j("gray.200","gray.600"),P=({index:v,style:g})=>{const E=w.dados[v];return e.jsxs(I,{style:g,align:"center",_hover:{bg:he},borderBottomWidth:"1px",borderColor:fe,children:[e.jsx(o,{width:"25%",px:4,isTruncated:!0,title:E.nome,children:E.nome}),e.jsxs(ae,{width:"30%",px:4,align:"start",spacing:0,children:[e.jsx(o,{isTruncated:!0,children:E.email}),e.jsx(o,{fontSize:"sm",color:"gray.500",children:E.telefone})]}),e.jsx(o,{width:"15%",px:4,children:E.perfil}),e.jsx(I,{width:"15%",px:4,justify:"center",children:ue(E.status,E.perfil)}),e.jsx(I,{width:"15%",px:4,justify:"center",children:e.jsxs(W,{spacing:1,children:[e.jsx(ne,{label:E.status==="ATIVO"?"Desativar":"Ativar",hasArrow:!0,children:e.jsx(C,{children:e.jsx(rr,{size:"sm",isChecked:E.status==="ATIVO",onChange:()=>te.mutate(E),isDisabled:E.id===(s==null?void 0:s.id)})})}),e.jsx(ne,{label:"WhatsApp",hasArrow:!0,children:e.jsx(K,{as:$e,href:`https://wa.me/55${E.telefone.replace(/\D/g,"")}`,isExternal:!0,size:"sm","aria-label":"WhatsApp",icon:e.jsx(bs,{}),variant:"ghost"})}),e.jsx(ne,{label:"Editar",hasArrow:!0,children:e.jsx(K,{size:"sm","aria-label":"Editar",icon:e.jsx(Pe,{}),variant:"ghost",onClick:()=>de(E)})}),e.jsx(ne,{label:"Excluir",hasArrow:!0,children:e.jsx(K,{size:"sm","aria-label":"Excluir",icon:e.jsx(Re,{}),variant:"ghost",colorScheme:"red",onClick:()=>ce(E),isDisabled:E.id===(s==null?void 0:s.id)})})]})})]})},h=({index:v,style:g})=>{const E=w.dados[v];return e.jsx(C,{style:g,px:2,py:2,children:e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",boxShadow:"sm",children:[e.jsxs(I,{justify:"space-between",align:"center",children:[e.jsx(V,{size:"sm",noOfLines:1,children:E.nome}),ue(E.status,E.perfil)]}),e.jsx(o,{fontSize:"sm",color:"gray.400",children:E.perfil}),e.jsx(Ue,{my:2}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Email:"}),e.jsx(o,{noOfLines:1,children:E.email})]}),e.jsxs(W,{justify:"space-between",children:[e.jsx(o,{fontSize:"sm",color:"gray.500",children:"Telefone:"}),e.jsx(o,{children:E.telefone})]}),e.jsxs(W,{mt:4,justify:"space-around",bg:U,p:2,borderRadius:"md",children:[e.jsx(ne,{label:E.status==="ATIVO"?"Desativar":"Ativar",children:e.jsx(C,{children:e.jsx(rr,{isChecked:E.status==="ATIVO",onChange:()=>te.mutate(E),isDisabled:E.id===(s==null?void 0:s.id)})})}),e.jsx(ne,{label:"WhatsApp",children:e.jsx(K,{as:$e,href:`https://wa.me/55${E.telefone.replace(/\D/g,"")}`,isExternal:!0,"aria-label":"WhatsApp",icon:e.jsx(bs,{}),variant:"ghost"})}),e.jsx(ne,{label:"Editar",children:e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),variant:"ghost",onClick:()=>de(E)})}),e.jsx(ne,{label:"Excluir",children:e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),variant:"ghost",colorScheme:"red",onClick:()=>ce(E),isDisabled:E.id===(s==null?void 0:s.id)})})]})]})})};return e.jsxs(C,{p:{base:4,md:8},children:[e.jsxs(I,{justify:"space-between",align:"center",mb:6,direction:{base:"column",md:"row"},gap:4,children:[e.jsx(V,{textAlign:{base:"center",md:"left"},children:"Gestão de Utilizadores"}),e.jsx(k,{leftIcon:e.jsx(Xe,{}),colorScheme:"teal",onClick:u,w:{base:"full",md:"auto"},children:"Adicionar Utilizador"})]}),e.jsx(C,{mb:6,children:e.jsxs(Qe,{children:[e.jsx(ts,{pointerEvents:"none",children:e.jsx(as,{color:"gray.300"})}),e.jsx(T,{placeholder:"Buscar por nome, email, telefone ou nickname...",value:b,onChange:v=>L(v.target.value)})]})}),$?e.jsx(O,{p:10,children:e.jsx(ge,{size:"xl"})}):H?e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Erro ao carregar utilizadores."})}):!(w!=null&&w.dados)||w.dados.length===0?e.jsx(O,{p:10,children:e.jsx(o,{children:"Nenhum utilizador encontrado."})}):e.jsxs(e.Fragment,{children:[B?e.jsx(Ge,{height:600,itemCount:w.dados.length,itemSize:190,width:"100%",ref:Q,children:h}):e.jsxs(C,{borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[e.jsxs(I,{bg:le,borderBottomWidth:"1px",fontWeight:"bold",role:"row",pr:"15px",children:[e.jsx(o,{width:"25%",p:4,children:"Nome"}),e.jsx(o,{width:"30%",p:4,children:"Contato"}),e.jsx(o,{width:"15%",p:4,children:"Perfil"}),e.jsx(o,{width:"15%",p:4,textAlign:"center",children:"Status"}),e.jsx(o,{width:"15%",p:4,textAlign:"center",children:"Ações"})]}),e.jsx(Ge,{height:600,itemCount:w.dados.length,itemSize:62,width:"100%",ref:Q,children:P})]}),w&&w.totalPaginas>1&&e.jsx(os,{paginaAtual:w.pagina||1,totalPaginas:w.totalPaginas||1,onPageChange:D})]}),e.jsx(ha,{isOpen:c,onClose:d}),e.jsx(xa,{isOpen:a,onClose:l,utilizador:p}),e.jsx(ms,{isOpen:i,leastDestructiveRef:F,onClose:f,children:e.jsx(me,{children:e.jsxs(js,{children:[e.jsx(je,{fontSize:"lg",fontWeight:"bold",children:"Confirmar Exclusão"}),e.jsxs(pe,{children:["Tem certeza que deseja excluir o utilizador ",e.jsx("strong",{children:p==null?void 0:p.nome}),"? Esta ação não pode ser desfeita."]}),e.jsxs(ye,{children:[e.jsx(k,{ref:F,onClick:f,children:"Cancelar"}),e.jsx(k,{colorScheme:"red",onClick:X,ml:3,isLoading:M.isPending,children:"Sim, Excluir"})]})]})})})]})},ja="http://localhost:3001/api",is=ke.create({baseURL:ja});is.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const pa=async s=>(await is.get("/reports/sales-summary",{params:s})).data,ga=async s=>(await is.get("/reports/product-ranking",{params:s})).data,fa=async s=>(await is.get("/reports/client-ranking",{params:s})).data,ba=async()=>(await is.get("/reports/client-analysis")).data,ya=async s=>(await is.get("/reports/seller-productivity",{params:s})).data,va=async s=>(await is.get("/reports/stock-entries",{params:s})).data,Hs=async(s,r)=>{const n=await is.get(s,{params:r,responseType:"blob"});return new Blob([n.data],{type:"application/pdf"})},Ca=async s=>Hs("/reports/product-ranking/pdf",s),Sa=async s=>Hs("/reports/client-ranking/pdf",s),wa=async s=>Hs("/reports/seller-productivity/pdf",s),Da=async s=>Hs("/reports/stock-entries/pdf",s),Rs={salesSummary:s=>["reports","salesSummary",s],productRanking:s=>["reports","productRanking",s],clientRanking:s=>["reports","clientRanking",s],clientAnalysis:()=>["reports","clientAnalysis"],sellerProductivity:s=>["reports","sellerProductivity",s],stockEntries:s=>["reports","stockEntries",s]},Ra=(s,r=!0)=>re({queryKey:Rs.salesSummary(s),queryFn:()=>pa(s),enabled:r,placeholderData:We}),Pa=(s,r=!0)=>re({queryKey:Rs.productRanking(s),queryFn:()=>ga(s),enabled:r,placeholderData:We}),Ea=(s,r=!0)=>re({queryKey:Rs.clientRanking(s),queryFn:()=>fa(s),enabled:r,placeholderData:We}),_a=(s=!0)=>re({queryKey:Rs.clientAnalysis(),queryFn:ba,enabled:s,staleTime:1e3*60*15}),qa=(s,r=!0)=>re({queryKey:Rs.sellerProductivity(s),queryFn:()=>ya(s),enabled:r,placeholderData:We}),Aa=(s,r=!0)=>re({queryKey:Rs.stockEntries(s),queryFn:()=>va(s),enabled:r,placeholderData:We}),ka=s=>s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),za=({kpis:s,isLoading:r})=>e.jsxs(ns,{columns:{base:1,md:3},spacing:6,mb:8,children:[e.jsxs(Ee,{as:ie,isLoaded:!r,p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",children:[e.jsx(_e,{children:"Faturamento Total"}),e.jsx(qe,{color:"green.500",children:ka((s==null?void 0:s.faturamentoTotal)??0)}),e.jsx(Ae,{children:"Receita no período"})]}),e.jsxs(Ee,{as:ie,isLoaded:!r,p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",children:[e.jsx(_e,{children:"Peso Total Vendido"}),e.jsxs(qe,{children:[((s==null?void 0:s.pesoTotalVendido)??0).toFixed(2)," kg/un"]}),e.jsx(Ae,{children:"Soma das quantidades"})]}),e.jsxs(Ee,{as:ie,isLoaded:!r,p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",children:[e.jsx(_e,{children:"Total de Transações"}),e.jsx(qe,{children:(s==null?void 0:s.totalTransacoes)??0}),e.jsx(Ae,{children:"Vendas realizadas"})]})]}),wr=s=>typeof s!="number"?"":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),Ta=s=>{const r=new Date(s);return r.setDate(r.getDate()+1),r.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})},Fa=({data:s,isLoading:r,isError:n})=>e.jsxs(C,{as:ie,isLoaded:!r,p:5,borderWidth:1,borderRadius:8,boxShadow:"sm",h:"400px",children:[e.jsx(V,{size:"md",mb:4,children:"Evolução das Vendas"}),n?e.jsx(O,{h:"90%",children:e.jsx(o,{color:"red.500",children:"Erro ao carregar dados do gráfico."})}):!s||s.length===0?e.jsx(O,{h:"90%",children:e.jsx(o,{color:"gray.500",children:"Nenhum dado de venda encontrado para o período selecionado."})}):e.jsx(hs,{width:"100%",height:"90%",children:e.jsxs(Ts,{data:s,margin:{top:5,right:20,left:20,bottom:5},children:[e.jsx(Fs,{strokeDasharray:"3 3"}),e.jsx(Ns,{dataKey:"data",tickFormatter:Ta}),e.jsx(Ls,{tickFormatter:wr,width:90}),e.jsx(xs,{formatter:a=>wr(a)}),e.jsx(Is,{wrapperStyle:{paddingTop:"20px"}}),e.jsx(cs,{dataKey:"faturamento",fill:"#38B2AC",name:"Faturamento"})]})})]}),Na=s=>s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),La=({data:s,isLoading:r})=>r?e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"Produto"}),e.jsx(N,{isNumeric:!0,children:"Valor Total (R$)"}),e.jsx(N,{isNumeric:!0,children:"Quantidade Total"})]})}),e.jsx(Be,{children:Array.from({length:5}).map((n,a)=>e.jsxs(se,{children:[e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})})]},a))})]})}):!s||s.length===0?e.jsx(O,{p:10,children:e.jsx(o,{color:"gray.500",children:"Nenhum produto vendido no período selecionado."})}):e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"Produto"}),e.jsx(N,{isNumeric:!0,children:"Valor Total (R$)"}),e.jsx(N,{isNumeric:!0,children:"Quantidade Total (kg/un)"})]})}),e.jsx(Be,{children:s.map((n,a)=>e.jsxs(se,{children:[e.jsx(z,{children:a+1}),e.jsx(z,{children:n.nome}),e.jsx(z,{isNumeric:!0,children:Na(n.valorTotal)}),e.jsx(z,{isNumeric:!0,children:n.quantidadeTotal.toFixed(2)})]},n.produtoId))})]})}),Ia=s=>s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),Ba=({data:s,isLoading:r})=>r?e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"Cliente"}),e.jsx(N,{children:"Contato"}),e.jsx(N,{isNumeric:!0,children:"Total de Compras"}),e.jsx(N,{isNumeric:!0,children:"Valor Gasto (R$)"})]})}),e.jsx(Be,{children:Array.from({length:5}).map((n,a)=>e.jsxs(se,{children:[e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})})]},a))})]})}):!s||s.length===0?e.jsx(O,{p:10,children:e.jsx(o,{color:"gray.500",children:"Nenhum cliente realizou compras no período selecionado."})}):e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"Cliente"}),e.jsx(N,{children:"Contato"}),e.jsx(N,{isNumeric:!0,children:"Total de Compras"}),e.jsx(N,{isNumeric:!0,children:"Valor Gasto (R$)"})]})}),e.jsx(Be,{children:s.map((n,a)=>e.jsxs(se,{children:[e.jsx(z,{children:a+1}),e.jsx(z,{children:n.nome}),e.jsx(z,{children:n.telefone}),e.jsx(z,{isNumeric:!0,children:n.totalCompras}),e.jsx(z,{isNumeric:!0,children:Ia(n.valorTotalGasto)})]},n.clienteId))})]})}),Dr=s=>s?new Date(`${s.split("T")[0]}T00:00:00`).toLocaleDateString("pt-BR"):"Nunca",Rr=s=>{if(!s)return;const r=s.replace(/\D/g,""),n=`https://wa.me/${r.startsWith("55")?r:"55"+r}`;window.open(n,"_blank")},Oa=({data:s,isLoading:r,isError:n})=>{const a=j("white","gray.800"),t=j("gray.600","gray.400");return r?e.jsx(O,{p:10,children:e.jsx(ge,{size:"xl"})}):n?e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Não foi possível carregar os dados de análise."})}):s?e.jsxs(ae,{spacing:8,align:"stretch",mt:6,children:[e.jsxs(C,{children:[e.jsxs(W,{mb:4,spacing:3,children:[e.jsx(V,{size:"md",children:"Clientes Ativos"}),e.jsx(Fe,{colorScheme:"green",fontSize:"md",px:3,py:1,borderRadius:"full",children:s.ativos.length})]}),e.jsx(o,{color:t,mt:-3,mb:4,children:"Clientes que realizaram compras nos últimos 90 dias."}),e.jsx(Ne,{borderWidth:1,borderRadius:"md",bg:a,children:e.jsxs(Le,{variant:"simple",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"Nome"}),e.jsx(N,{children:"Última Compra"}),e.jsx(N,{children:"Contato"})]})}),e.jsx(Be,{children:s.ativos.length===0?e.jsx(se,{children:e.jsx(z,{colSpan:3,textAlign:"center",children:"Nenhum cliente ativo encontrado."})}):s.ativos.map(l=>e.jsxs(se,{children:[e.jsx(z,{fontWeight:"medium",children:l.nome}),e.jsx(z,{children:Dr(l.data_ultima_compra)}),e.jsx(z,{children:e.jsxs($e,{onClick:()=>Rr(l.telefone),color:"teal.500",display:"flex",alignItems:"center",_hover:{textDecoration:"underline"},children:[e.jsx(De,{as:bs,mr:2})," ",l.telefone]})})]},`ativo-${l.clienteId}`))})]})})]}),e.jsxs(C,{children:[e.jsxs(W,{mb:4,spacing:3,children:[e.jsx(V,{size:"md",children:"Clientes Inativos"}),e.jsx(Fe,{colorScheme:"red",fontSize:"md",px:3,py:1,borderRadius:"full",children:s.inativos.length})]}),e.jsx(o,{color:t,mt:-3,mb:4,children:"Clientes que não compram há mais de 90 dias ou nunca compraram."}),e.jsx(Ne,{borderWidth:1,borderRadius:"md",bg:a,children:e.jsxs(Le,{variant:"simple",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"Nome"}),e.jsx(N,{children:"Última Compra"}),e.jsx(N,{children:"Contato"})]})}),e.jsx(Be,{children:s.inativos.length===0?e.jsx(se,{children:e.jsx(z,{colSpan:3,textAlign:"center",children:"Nenhum cliente inativo encontrado."})}):s.inativos.map(l=>e.jsxs(se,{children:[e.jsx(z,{fontWeight:"medium",children:l.nome}),e.jsx(z,{children:Dr(l.data_ultima_compra)}),e.jsx(z,{children:e.jsxs($e,{onClick:()=>Rr(l.telefone),color:"teal.500",display:"flex",alignItems:"center",_hover:{textDecoration:"underline"},children:[e.jsx(De,{as:bs,mr:2})," ",l.telefone]})})]},`inativo-${l.clienteId}`))})]})})]})]}):e.jsx(O,{p:10,children:e.jsx(o,{color:t,children:"Nenhum dado de cliente para analisar."})})},Ma=s=>s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),$a=({data:s,isLoading:r,isError:n})=>r?e.jsx(Ne,{children:e.jsxs(Le,{variant:"simple",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"Vendedor"}),e.jsx(N,{isNumeric:!0,children:"Nº de Vendas"}),e.jsx(N,{isNumeric:!0,children:"Valor Total Vendido (R$)"})]})}),e.jsx(Be,{children:Array.from({length:5}).map((a,t)=>e.jsxs(se,{children:[e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})})]},t))})]})}):n?e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Não foi possível carregar os dados de produtividade."})}):!s||s.length===0?e.jsx(O,{p:10,children:e.jsx(o,{color:"gray.500",children:"Nenhuma venda encontrada para os vendedores no período selecionado."})}):e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"#"}),e.jsx(N,{children:"Vendedor"}),e.jsx(N,{isNumeric:!0,children:"Nº de Vendas"}),e.jsx(N,{isNumeric:!0,children:"Valor Total Vendido (R$)"})]})}),e.jsx(Be,{children:s.map((a,t)=>e.jsxs(se,{children:[e.jsx(z,{fontWeight:"bold",color:"gray.500",children:t+1}),e.jsx(z,{children:e.jsxs(W,{children:[e.jsx(Br,{size:"sm",name:a.nome}),e.jsx(o,{fontWeight:"medium",children:a.nome})]})}),e.jsx(z,{isNumeric:!0,children:a.numeroDeVendas}),e.jsx(z,{isNumeric:!0,fontWeight:"bold",color:"green.500",children:Ma(a.valorTotalVendido)})]},a.vendedorId))})]})}),Wa=s=>s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),Va=s=>new Date(s).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Ka=({data:s,isLoading:r,isError:n})=>{const a=j("gray.600","gray.400");return r?e.jsx(Ne,{children:e.jsxs(Le,{variant:"simple",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"Data"}),e.jsx(N,{children:"Produto"}),e.jsx(N,{children:"Responsável"}),e.jsx(N,{isNumeric:!0,children:"Qtd. Adicionada"}),e.jsx(N,{isNumeric:!0,children:"Custo Total"}),e.jsx(N,{children:"Observações"})]})}),e.jsx(Be,{children:Array.from({length:8}).map((t,l)=>e.jsxs(se,{children:[e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})}),e.jsx(z,{children:e.jsx(ie,{height:"20px"})})]},l))})]})}):n?e.jsx(O,{p:10,children:e.jsx(o,{color:"red.500",children:"Não foi possível carregar o histórico de estoque."})}):!s||s.length===0?e.jsx(O,{p:10,children:e.jsx(o,{color:a,children:"Nenhuma entrada de estoque registrada no período selecionado."})}):e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"Data"}),e.jsx(N,{children:"Produto"}),e.jsx(N,{children:"Responsável"}),e.jsx(N,{isNumeric:!0,children:"Qtd. Adicionada"}),e.jsx(N,{isNumeric:!0,children:"Custo Total"}),e.jsx(N,{children:"Observações"})]})}),e.jsx(Be,{children:s.map(t=>e.jsxs(se,{children:[e.jsx(z,{children:Va(t.data_entrada)}),e.jsx(z,{fontWeight:"medium",children:t.produto_nome}),e.jsx(z,{children:t.responsavel_nome}),e.jsx(z,{isNumeric:!0,children:t.quantidade_adicionada}),e.jsx(z,{isNumeric:!0,color:"orange.500",children:Wa(t.custo_total)}),e.jsx(z,{children:e.jsx(ne,{label:t.observacao||"",placement:"top",hasArrow:!0,children:e.jsx(o,{isTruncated:!0,maxW:"150px",children:t.observacao||"---"})})})]},t.id))})]})})},Vs=s=>Ye(s,"yyyy-MM-dd"),Ua=()=>{const s=new Date,r=Se(),[n,a]=m.useState(Vs(As(s))),[t,l]=m.useState(Vs(qs(s))),[c,u]=m.useState("valor"),[d,i]=m.useState(0),x=(g,E)=>{a(Vs(g)),l(Vs(E))},f={startDate:n,endDate:t},p={...f,orderBy:c},{data:S,isLoading:R,isError:D}=Ra(f,d===0),{data:b,isLoading:L}=Pa(p,d===1),{data:y,isLoading:F}=Ea(f,d===2),{data:B,isLoading:Q,isError:U}=_a(d===3),{data:w,isLoading:$,isError:H}=qa(f,d===4),{data:te,isLoading:M,isError:de}=Aa(f,d===5),ce=g=>{const E=URL.createObjectURL(g);window.open(E,"_blank"),r({title:"Relatório Gerado",description:"O PDF foi aberto em uma nova aba.",status:"success"})},X=g=>{var E,oe;r({title:"Erro ao gerar PDF",description:((oe=(E=g.response)==null?void 0:E.data)==null?void 0:oe.error)||"Não foi possível gerar o relatório.",status:"error"})},ue=ee({mutationFn:Ca,onSuccess:ce,onError:X}),le=ee({mutationFn:Sa,onSuccess:ce,onError:X}),he=ee({mutationFn:wa,onSuccess:ce,onError:X}),fe=ee({mutationFn:Da,onSuccess:ce,onError:X}),P=()=>{switch(r({title:"Gerando relatório...",status:"info",duration:1500}),d){case 1:ue.mutate(p);break;case 2:le.mutate(f);break;case 4:he.mutate(f);break;case 5:fe.mutate(f);break;default:r({title:"Aviso",description:"Este relatório não possui uma exportação para PDF.",status:"warning"})}},h=ue.isPending||le.isPending||he.isPending||fe.isPending,v=[1,2,4,5].includes(d);return e.jsxs(C,{p:{base:4,md:8},children:[e.jsxs(I,{justify:"space-between",align:"center",mb:2,direction:{base:"column",md:"row"},gap:4,children:[e.jsxs(C,{children:[e.jsx(V,{as:"h1",children:"Relatórios Gerenciais"}),e.jsx(o,{color:"gray.500",children:"Selecione um período para visualizar os relatórios de desempenho do negócio."})]}),e.jsx(k,{leftIcon:e.jsx(De,{as:Gr}),colorScheme:"teal",onClick:P,isLoading:h,isDisabled:!v,loadingText:"Gerando...",w:{base:"full",md:"auto"},children:"Gerar Relatório"})]}),e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",my:6,bg:j("gray.50","gray.700"),children:[e.jsx(V,{size:"md",mb:4,children:"Filtrar por Período"}),e.jsxs(ns,{columns:{base:2,md:4},spacing:2,mb:4,children:[e.jsx(k,{onClick:()=>x(As(s),qs(s)),children:"Este Mês"}),e.jsx(k,{onClick:()=>x(Qs(s,30),s),children:"Últimos 30 dias"}),e.jsx(k,{onClick:()=>x(An(s),qn(s)),children:"Este Trimestre"}),e.jsx(k,{onClick:()=>x(zn(s),kn(s)),children:"Este Ano"})]}),e.jsxs(I,{gap:4,align:"flex-end",direction:{base:"column",md:"row"},children:[e.jsxs(C,{flex:1,w:"full",children:[e.jsx(o,{fontSize:"sm",mb:1,children:"Data de Início"}),e.jsx(T,{type:"date",value:n,onChange:g=>a(g.target.value),bg:j("white","gray.800")})]}),e.jsxs(C,{flex:1,w:"full",children:[e.jsx(o,{fontSize:"sm",mb:1,children:"Data de Fim"}),e.jsx(T,{type:"date",value:t,onChange:g=>l(g.target.value),bg:j("white","gray.800")})]})]})]}),e.jsxs(lr,{isFitted:!0,variant:"enclosed-colored",onChange:g=>i(g),children:[e.jsxs(dr,{overflowX:"auto",overflowY:"hidden",sx:{"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:[e.jsx(Ve,{children:"Vendas Gerais"}),e.jsx(Ve,{children:"Produtos"}),e.jsx(Ve,{children:"Clientes"}),e.jsx(Ve,{children:"Análise"}),e.jsx(Ve,{children:"Produtividade"}),e.jsx(Ve,{children:"Estoque"})]}),e.jsxs(cr,{children:[e.jsxs(Ke,{children:[e.jsx(za,{kpis:S==null?void 0:S.kpis,isLoading:R}),e.jsx(Fa,{data:S==null?void 0:S.evolucaoVendas,isLoading:R,isError:D})]}),e.jsxs(Ke,{children:[e.jsx(I,{justify:"flex-end",mb:4,children:e.jsxs(I,{align:"center",gap:2,children:[e.jsx(o,{children:"Ordenar por:"}),e.jsxs(Je,{w:"200px",value:c,onChange:g=>u(g.target.value),children:[e.jsx("option",{value:"valor",children:"Maior Valor (R$)"}),e.jsx("option",{value:"quantidade",children:"Maior Quantidade"})]})]})}),e.jsx(La,{data:b,isLoading:L})]}),e.jsx(Ke,{children:e.jsx(Ba,{data:y,isLoading:F})}),e.jsx(Ke,{children:e.jsx(Oa,{data:B,isLoading:Q,isError:U})}),e.jsx(Ke,{children:e.jsx($a,{data:w,isLoading:$,isError:H})}),e.jsx(Ke,{children:e.jsx(Ka,{data:te,isLoading:M,isError:de})})]})]})]})},Qa=()=>{var u,d,i;const s=Se(),r=_r(),{register:n,handleSubmit:a,formState:{errors:t}}=Oe(),l=ee({mutationFn:Pt,onSuccess:x=>{s({title:"Solicitação Enviada!",description:x.message,status:"success",duration:7e3,isClosable:!0}),r("/login")},onError:x=>{var f,p;s({title:"Erro na Solicitação",description:((p=(f=x.response)==null?void 0:f.data)==null?void 0:p.error)||x.message,status:"error",duration:7e3,isClosable:!0})}}),c=x=>{l.mutate(x)};return e.jsx(Tn,{centerContent:!0,children:e.jsxs(C,{p:8,mt:20,maxWidth:"450px",borderWidth:1,borderRadius:8,boxShadow:"lg",children:[e.jsx("form",{onSubmit:a(c),children:e.jsxs(ae,{spacing:4,children:[e.jsx(V,{as:"h1",size:"lg",textAlign:"center",children:"Solicitar Acesso"}),e.jsx(o,{textAlign:"center",color:"gray.600",children:"Preencha seus dados. Um administrador irá analisar e liberar seu acesso."}),e.jsxs(q,{isRequired:!0,isInvalid:!!t.nome,children:[e.jsx(A,{children:"Nome Completo"}),e.jsx(T,{...n("nome",{required:"Nome é obrigatório"})}),e.jsx(Z,{children:(u=t.nome)==null?void 0:u.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!t.email,children:[e.jsx(A,{children:"Email"}),e.jsx(T,{type:"email",...n("email",{required:"Email é obrigatório"})}),e.jsx(Z,{children:(d=t.email)==null?void 0:d.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!t.telefone,children:[e.jsx(A,{children:"Telefone (com DDD)"}),e.jsx(T,{type:"tel",placeholder:"Ex: 62999998888",...n("telefone",{required:"Telefone é obrigatório"})}),e.jsx(Z,{children:(i=t.telefone)==null?void 0:i.message})]}),e.jsx(k,{type:"submit",colorScheme:"teal",width:"full",isLoading:l.isPending,children:"Enviar Solicitação"})]})}),e.jsxs(o,{mt:6,textAlign:"center",children:["Já tem uma conta?"," ",e.jsx($e,{as:ar,to:"/login",color:"teal.500",fontWeight:"bold",children:"Fazer Login"})]})]})})},Ga=()=>e.jsxs(C,{textAlign:"center",py:10,px:6,mt:"20",children:[e.jsx(V,{display:"inline-block",as:"h2",size:"2xl",bgGradient:"linear(to-r, red.400, red.600)",backgroundClip:"text",children:"404"}),e.jsx(o,{fontSize:"18px",mt:3,mb:2,children:"Página Não Encontrada"}),e.jsx(o,{color:"gray.500",mb:6,children:"Desculpe, a página que você está procurando não existe ou foi movida."}),e.jsx(k,{as:ar,to:"/",colorScheme:"red",variant:"solid",children:"Voltar para o Início"})]}),Ha="http://localhost:3001/api",Zs=ke.create({baseURL:`${Ha}/financas`});Zs.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const Za=async s=>(await Zs.get("/dashboard-consolidado",{params:s})).data,Ya=async s=>(await Zs.get("/analise-mensal",{params:s})).data,tn=async(s,r)=>{const n=await Zs.get(s,{params:r,responseType:"blob"});return new Blob([n.data],{type:"application/pdf"})},Ja=async s=>tn("/report/receitas-pessoais/pdf",s),Xa=async s=>tn("/report/despesas-pessoais/pdf",s),_s=s=>s===void 0?"R$ 0,00":s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),eo=({filters:s})=>{const r=j("white","gray.700"),n=j("gray.200","gray.600"),{data:a,isLoading:t,isError:l}=re({queryKey:["dashboardConsolidado",s],queryFn:()=>Za(s),enabled:!!s.startDate&&!!s.endDate}),c=a==null?void 0:a.kpis;return e.jsxs(C,{children:[e.jsx(V,{size:"lg",mb:6,children:"Dashboard Consolidado"}),e.jsx(ie,{isLoaded:!t,minH:"150px",borderRadius:"md",children:l?e.jsx(O,{h:"150px",bg:"red.50",borderRadius:"md",children:e.jsx(o,{color:"red.500",children:"Erro ao carregar os indicadores."})}):e.jsxs(ns,{columns:{base:1,md:2,lg:5},spacing:6,children:[e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:"md",bg:r,borderColor:n,children:[e.jsxs(W,{justify:"space-between",children:[e.jsx(_e,{children:"Receita Total Consolidada"}),e.jsx(De,{as:Fn,color:"green.400",w:6,h:6})]}),e.jsx(qe,{color:"green.500",children:_s(c==null?void 0:c.receitaTotalConsolidada)}),e.jsx(Ae,{children:"Receitas do Negócio + Pessoais"})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:"md",bg:r,borderColor:n,children:[e.jsxs(W,{justify:"space-between",children:[e.jsx(_e,{children:"Despesa Total Consolidada"}),e.jsx(De,{as:Nn,color:"red.400",w:6,h:6})]}),e.jsx(qe,{color:"red.500",children:_s(c==null?void 0:c.despesaTotalConsolidada)}),e.jsx(Ae,{children:"Despesas do Negócio + Pessoais"})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:"md",bg:r,borderColor:n,children:[e.jsxs(W,{justify:"space-between",children:[e.jsx(_e,{children:"Apenas Receitas Pessoais"}),e.jsx(De,{as:Ln,color:"cyan.400",w:6,h:6})]}),e.jsx(qe,{color:"cyan.500",children:_s(c==null?void 0:c.receitasPessoais)}),e.jsx(Ae,{children:"Receitas fora do negócio"})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:"md",bg:r,borderColor:n,children:[e.jsxs(W,{justify:"space-between",children:[e.jsx(_e,{children:"Apenas Despesas Pessoais"}),e.jsx(De,{as:In,color:"orange.400",w:6,h:6})]}),e.jsx(qe,{color:"orange.500",children:_s(c==null?void 0:c.despesasPessoais)}),e.jsx(Ae,{children:"Gastos fora do negócio"})]}),e.jsxs(Ee,{p:5,borderWidth:1,borderRadius:"md",bg:r,borderColor:n,children:[e.jsxs(W,{justify:"space-between",children:[e.jsx(_e,{children:"Saldo Consolidado"}),e.jsx(De,{as:Bn,color:"blue.400",w:6,h:6})]}),e.jsx(qe,{color:c&&c.saldoConsolidado>=0?"blue.500":"red.500",children:_s(c==null?void 0:c.saldoConsolidado)}),e.jsxs(Ae,{children:[e.jsx(Qr,{type:c&&c.saldoConsolidado>=0?"increase":"decrease"}),"Balanço do período"]})]})]})})]})},so="http://localhost:3001/api",Ms=ke.create({baseURL:`${so}/receitas-externas`});Ms.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const ro=async(s,r)=>(await Ms.get("/",{params:{startDate:s,endDate:r}})).data,no=async s=>(await Ms.post("/",s)).data,to=async({id:s,data:r})=>(await Ms.put(`/${s}`,r)).data,ao=async s=>{await Ms.delete(`/${s}`)},oo=({isOpen:s,onClose:r,receita:n,onSave:a,isLoading:t})=>{var f,p,S;const{register:l,handleSubmit:c,reset:u,formState:{errors:d}}=Oe(),i=ve({base:"full",md:"md"});m.useEffect(()=>{s&&u(n?{...n,data_recebimento:n.data_recebimento.split("T")[0]}:{descricao:"",valor:void 0,data_recebimento:new Date().toISOString().split("T")[0],categoria:""})},[n,s,u]);const x=R=>{a(R,n==null?void 0:n.id)};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:i,children:[e.jsx(me,{}),e.jsxs(ss,{as:"form",onSubmit:c(x),children:[e.jsx(je,{borderBottomWidth:"1px",children:n?"Editar Receita":"Adicionar Nova Receita"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!d.descricao,children:[e.jsx(A,{children:"Descrição"}),e.jsx(T,{...l("descricao",{required:"Descrição é obrigatória",validate:R=>R.trim()!==""||"A descrição não pode conter apenas espaços."}),textTransform:"uppercase"}),e.jsx(Z,{children:(f=d.descricao)==null?void 0:f.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.valor,children:[e.jsx(A,{children:"Valor (R$)"}),e.jsx(T,{type:"number",step:"0.01",...l("valor",{required:"Valor é obrigatório",valueAsNumber:!0,min:{value:.01,message:"O valor deve ser maior que zero."}})}),e.jsx(Z,{children:(p=d.valor)==null?void 0:p.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!d.data_recebimento,children:[e.jsx(A,{children:"Data de Recebimento"}),e.jsx(T,{type:"date",...l("data_recebimento",{required:"Data é obrigatória"})}),e.jsx(Z,{children:(S=d.data_recebimento)==null?void 0:S.message})]}),e.jsxs(q,{children:[e.jsx(A,{children:"Categoria (Opcional)"}),e.jsx(T,{...l("categoria"),placeholder:"Ex: Salário, Aluguel, Freelance",textTransform:"uppercase"})]})]})}),e.jsxs(ye,{borderTopWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"teal",type:"submit",isLoading:t,children:"Salvar"})]})]})]})},io=()=>{const s=ze(),r=Se(),{isOpen:n,onOpen:a,onClose:t}=xe(),{isOpen:l,onOpen:c,onClose:u}=xe(),[d,i]=m.useState(null),[x,f]=m.useState(null),p=m.useRef(null),{data:S,isLoading:R,isError:D}=re({queryKey:["receitasExternas"],queryFn:()=>ro()}),b=ee({mutationFn:({data:w,id:$})=>$?to({id:$,data:w}):no(w),onSuccess:()=>{s.invalidateQueries({queryKey:["receitasExternas"]}),s.invalidateQueries({queryKey:["dashboardConsolidado"]}),r({title:"Receita salva com sucesso!",status:"success"}),t()},onError:w=>{var $,H;r({title:"Erro ao salvar receita",description:((H=($=w.response)==null?void 0:$.data)==null?void 0:H.error)||w.message,status:"error"})}}),L=ee({mutationFn:ao,onSuccess:()=>{s.invalidateQueries({queryKey:["receitasExternas"]}),s.invalidateQueries({queryKey:["dashboardConsolidado"]}),r({title:"Receita excluída com sucesso!",status:"success"}),u()},onError:w=>{var $,H;r({title:"Erro ao excluir receita",description:((H=($=w.response)==null?void 0:$.data)==null?void 0:H.error)||w.message,status:"error"})}}),y=()=>{i(null),a()},F=w=>{i(w),a()},B=w=>{f(w),c()},Q=()=>{x&&L.mutate(x.id)},U=(w,$)=>{b.mutate({data:w,id:$})};return e.jsxs(C,{children:[e.jsxs(I,{justify:"space-between",align:"center",mb:6,direction:{base:"column",md:"row"},gap:4,children:[e.jsx(V,{textAlign:{base:"center",md:"left"},children:"Gestão de Receitas Externas"}),e.jsx(k,{leftIcon:e.jsx(Xe,{}),colorScheme:"green",onClick:y,w:{base:"full",md:"auto"},children:"Adicionar Receita"})]}),R?e.jsx(O,{p:8,children:e.jsx(ge,{size:"xl"})}):D?e.jsx(O,{p:8,children:e.jsx(o,{color:"red.500",children:"Erro ao carregar receitas."})}):e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"Data"}),e.jsx(N,{children:"Descrição"}),e.jsx(N,{children:"Categoria"}),e.jsx(N,{isNumeric:!0,children:"Valor (R$)"}),e.jsx(N,{children:"Ações"})]})}),e.jsx(Be,{children:S==null?void 0:S.map(w=>e.jsxs(se,{children:[e.jsx(z,{children:new Date(w.data_recebimento).toLocaleDateString("pt-BR",{timeZone:"UTC"})}),e.jsx(z,{children:w.descricao}),e.jsx(z,{children:w.categoria||"---"}),e.jsx(z,{isNumeric:!0,color:"green.500",fontWeight:"bold",children:w.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx(z,{children:e.jsxs(W,{children:[e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),onClick:()=>F(w)}),e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),colorScheme:"red",onClick:()=>B(w)})]})})]},w.id))})]})}),e.jsx(oo,{isOpen:n,onClose:t,receita:d,onSave:U,isLoading:b.isPending}),e.jsxs(ms,{isOpen:l,leastDestructiveRef:p,onClose:u,isCentered:!0,children:[e.jsx(me,{}),e.jsxs(js,{children:[e.jsx(je,{children:"Confirmar Exclusão"}),e.jsxs(pe,{children:['Tem certeza que deseja excluir a receita "',e.jsx("strong",{children:x==null?void 0:x.descricao}),'"?']}),e.jsxs(ye,{children:[e.jsx(k,{ref:p,onClick:u,children:"Cancelar"}),e.jsx(k,{colorScheme:"red",onClick:Q,ml:3,isLoading:L.isPending,children:"Sim, Excluir"})]})]})]})]})},lo="http://localhost:3001/api",gs=ke.create({baseURL:`${lo}/despesas-pessoais`});gs.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const co=async(s,r)=>(await gs.get("/",{params:{startDate:s,endDate:r}})).data,uo=async s=>(await gs.post("/",s)).data,ho=async({id:s,data:r})=>(await gs.put(`/${s}`,r)).data,an=async(s,r,n)=>(await gs.patch(`/${s}/toggle-pago`,{pago:r,data_pagamento:n})).data,xo=async s=>{await gs.delete(`/${s}`)},mo=async()=>(await gs.get("/pendentes")).data,jo=({isOpen:s,onClose:r,despesa:n,onSave:a,isLoading:t,portalContainerRef:l})=>{var b,L;const{register:c,handleSubmit:u,reset:d,control:i,watch:x,formState:{errors:f}}=Oe({defaultValues:{recorrente:!1,parcelado:void 0,parcela_atual:1,quantidade_parcelas:1}}),p=ve({base:"full",md:"md"}),S=x("recorrente"),R=x("parcelado");m.useEffect(()=>{s&&d(n?{descricao:n.descricao,valor:n.valor,data_vencimento:Ye(Ze(n.data_vencimento),"yyyy-MM-dd"),categoria:n.categoria||"",recorrente:n.recorrente}:{descricao:"",valor:"",data_vencimento:new Date().toISOString().split("T")[0],categoria:"",recorrente:!1,parcelado:void 0,parcela_atual:1,quantidade_parcelas:1})},[n,s,d]);const D=y=>{a(y,n==null?void 0:n.id)};return e.jsxs(es,{isOpen:s,placement:"right",onClose:r,size:p,portalProps:{containerRef:l},children:[e.jsx(me,{}),e.jsx("form",{onSubmit:u(D),children:e.jsxs(ss,{children:[e.jsx(je,{borderBottomWidth:"1px",children:n?"Editar Despesa":"Adicionar Nova Despesa"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(ae,{spacing:4,children:[e.jsxs(q,{isRequired:!0,isInvalid:!!f.descricao,children:[e.jsx(A,{children:"Descrição"}),e.jsx(T,{...c("descricao",{required:"Descrição é obrigatória",validate:y=>y.trim()!==""||"A descrição não pode conter apenas espaços."}),placeholder:"Ex: CONTA DE LUZ",textTransform:"uppercase"}),e.jsx(Z,{children:(b=f.descricao)==null?void 0:b.message})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!f.valor,children:[e.jsx(A,{children:"Valor (R$)"}),e.jsx(T,{type:"number",step:"0.01",...c("valor",{required:"Valor é obrigatório",valueAsNumber:!0,min:{value:.01,message:"O valor deve ser maior que zero."}})}),e.jsx(Z,{children:(L=f.valor)==null?void 0:L.message})]}),e.jsxs(q,{children:[e.jsx(A,{children:"Categoria (Opcional)"}),e.jsx(T,{...c("categoria"),placeholder:"Ex: MORADIA",textTransform:"uppercase"})]}),e.jsxs(q,{isRequired:!0,isInvalid:!!f.data_vencimento,children:[e.jsx(A,{children:"Data de Vencimento"}),e.jsx(T,{type:"date",...c("data_vencimento",{required:!0})})]}),e.jsxs(q,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx(A,{htmlFor:"recorrente-switch",mb:"0",children:"É uma despesa recorrente?"}),e.jsx(rr,{id:"recorrente-switch",...c("recorrente"),isDisabled:!!n})]}),e.jsx(Js,{in:S&&!n,animateOpacity:!0,style:{width:"100%"},children:e.jsxs(ae,{spacing:4,borderWidth:1,borderRadius:"md",p:4,mt:2,align:"flex-start",children:[e.jsxs(q,{as:"fieldset",isRequired:S,children:[e.jsx(A,{as:"legend",children:"Tipo de Recorrência"}),e.jsx(or,{control:i,name:"parcelado",rules:{required:S},render:({field:y})=>e.jsx(On,{...y,children:e.jsxs(W,{spacing:"24px",children:[e.jsx(gr,{value:"sim",children:"Parcelamento (com fim)"}),e.jsx(gr,{value:"nao",children:"Assinatura (contínua)"})]})})})]}),e.jsx(Js,{in:R==="sim",animateOpacity:!0,style:{width:"100%"},children:e.jsxs(ae,{spacing:4,align:"stretch",children:[e.jsxs(W,{spacing:4,children:[e.jsxs(q,{isRequired:R==="sim",isInvalid:!!f.parcela_atual,children:[e.jsx(A,{children:"Parcela Atual"}),e.jsx(ks,{min:1,children:e.jsx(zs,{...c("parcela_atual",{required:R==="sim",valueAsNumber:!0})})})]}),e.jsxs(q,{isRequired:R==="sim",isInvalid:!!f.quantidade_parcelas,children:[e.jsx(A,{children:"de (Total)"}),e.jsx(ks,{min:1,children:e.jsx(zs,{...c("quantidade_parcelas",{required:R==="sim",valueAsNumber:!0})})})]})]}),e.jsxs(q,{isRequired:R==="sim",isInvalid:!!f.data_vencimento,children:[e.jsx(A,{children:"Vencimento da Parcela Atual"}),e.jsx(T,{type:"date",...c("data_vencimento",{required:R==="sim"})})]})]})}),e.jsx(Js,{in:R==="nao",animateOpacity:!0,style:{width:"100%"},children:e.jsxs(q,{isRequired:R==="nao",isInvalid:!!f.data_vencimento,children:[e.jsx(A,{children:"Data do Próximo Vencimento"}),e.jsx(T,{type:"date",...c("data_vencimento",{required:R==="nao"})})]})})]})})]})}),e.jsxs(ye,{borderTopWidth:"1px",children:[e.jsx(k,{variant:"outline",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"teal",type:"submit",isLoading:t,children:"Salvar"})]})]})})]})},er=s=>{if(!s)return"Data Inválida";const r=Ze(s);return fs(r)?r.toLocaleDateString("pt-BR",{timeZone:"UTC"}):"Data Inválida"},po=({isOpen:s,onClose:r,onConfirm:n,isLoading:a})=>{const[t,l]=m.useState(Ye(new Date,"yyyy-MM-dd")),c=()=>{n(t)};return e.jsxs(ys,{isOpen:s,onClose:r,isCentered:!0,children:[e.jsx(me,{}),e.jsxs(vs,{children:[e.jsx(je,{children:"Confirmar Data do Pagamento"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(q,{children:[e.jsx(A,{children:"Data em que o pagamento foi realizado"}),e.jsx(T,{type:"date",value:t,onChange:u=>l(u.target.value)})]})}),e.jsxs(ye,{children:[e.jsx(k,{variant:"ghost",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"green",onClick:c,isLoading:a,children:"Confirmar Pagamento"})]})]})]})},go=({filters:s,termoBusca:r})=>{const n=ze(),a=Se(),{isOpen:t,onOpen:l,onClose:c}=xe(),{isOpen:u,onOpen:d,onClose:i}=xe(),{isOpen:x,onOpen:f,onClose:p}=xe(),[S,R]=m.useState(null),[D,b]=m.useState(null),[L,y]=m.useState(null),F=m.useRef(null),B=m.useRef(null),{data:Q,isLoading:U,isError:w}=re({queryKey:["despesasPessoais",s],queryFn:()=>co(s.startDate,s.endDate),enabled:!!s.startDate&&!!s.endDate}),$=ee({mutationFn:P=>P.id?ho({id:P.id,data:P.data}):uo(P.data),onSuccess:P=>{n.invalidateQueries({queryKey:["despesasPessoais"]}),n.invalidateQueries({queryKey:["dashboardConsolidado"]});const h=Array.isArray(P)?"criada":"atualizada";a({title:`Despesa ${h} com sucesso!`,status:"success"}),c()},onError:P=>{var h,v;a({title:"Erro ao salvar despesa",description:((v=(h=P.response)==null?void 0:h.data)==null?void 0:v.error)||P.message,status:"error"})}}),H=ee({mutationFn:xo,onSuccess:()=>{n.invalidateQueries({queryKey:["despesasPessoais"]}),n.invalidateQueries({queryKey:["dashboardConsolidado"]}),a({title:"Despesa(s) excluída(s) com sucesso!",status:"success"}),i()},onError:P=>{var h,v;a({title:"Erro ao excluir despesa",description:((v=(h=P.response)==null?void 0:h.data)==null?void 0:v.error)||P.message,status:"error"})}}),te=ee({mutationFn:P=>an(P.despesa.id,!P.despesa.pago,P.dataPagamento),onSuccess:()=>{n.invalidateQueries({queryKey:["despesasPessoais"]}),n.invalidateQueries({queryKey:["dashboardConsolidado"]}),a({title:"Status de pagamento atualizado!",status:"info",duration:2e3}),p()},onError:P=>{var h,v;a({title:"Erro ao atualizar pagamento",description:((v=(h=P.response)==null?void 0:h.data)==null?void 0:v.error)||P.message,status:"error"})}}),M=m.useMemo(()=>{if(!Q)return[];const P=r.toLowerCase(),h=r?Q.filter(G=>G.descricao.toLowerCase().includes(P)||G.categoria&&G.categoria.toLowerCase().includes(P)):Q,v=h.filter(G=>{if(G.pago){if(!G.data_pagamento)return!1;const _=Ze(G.data_pagamento);return fs(_)?_>=Ze(s.startDate)&&_<=Ze(s.endDate):!1}return!0}),g=v.filter(G=>!G.parcela_id&&!G.recorrente),E=v.filter(G=>G.recorrente&&!G.parcela_id),oe=h.filter(G=>!!G.parcela_id),be=new Map;oe.forEach(G=>{const _=G.parcela_id;be.has(_)||be.set(_,[]),be.get(_).push(G)});const Y=[];return be.forEach(G=>{const _=G.filter(J=>!J.pago).sort((J,$s)=>(J.numero_parcela||0)-($s.numero_parcela||0))[0];if(!_)return;const Ce=G.reduce((J,$s)=>$s.pago?J:J+$s.valor,0);Y.push({parcela_id:_.parcela_id,descricaoBase:_.descricao.replace(/\s*\(\d+\/\d+\)$/,""),proximaParcela:_,saldoRestante:Ce,totalParcelas:_.total_parcelas||0,categoria:_.categoria})}),[...g,...E,...Y].sort((G,_)=>{const Ce=Ze("proximaParcela"in G?G.proximaParcela.data_vencimento:G.data_vencimento),J=Ze("proximaParcela"in _?_.proximaParcela.data_vencimento:_.data_vencimento);return Ce.getTime()-J.getTime()})},[Q,r,s.startDate,s.endDate]),de=()=>{R(null),l()},ce=P=>{R(P),l()},X=P=>{b(P),d()},ue=(P,h)=>{$.mutate({data:P,id:h})},le=()=>{if(!D)return;const P="proximaParcela"in D?D.proximaParcela.id:D.id;H.mutate(P)},he=P=>{P.pago?te.mutate({despesa:P}):(y(P),f())},fe=P=>{L&&te.mutate({despesa:L,dataPagamento:P})};return e.jsxs(C,{children:[e.jsx("div",{ref:B}),e.jsxs(I,{justify:"space-between",align:"center",mb:6,direction:{base:"column",md:"row"},gap:4,children:[e.jsx(V,{textAlign:{base:"center",md:"left"},children:"Gestão de Despesas Pessoais"}),e.jsx(k,{leftIcon:e.jsx(Xe,{}),colorScheme:"red",onClick:de,w:{base:"full",md:"auto"},children:"Adicionar Despesa"})]}),U?e.jsx(O,{p:8,children:e.jsx(ge,{size:"xl"})}):w?e.jsx(O,{p:8,children:e.jsx(o,{color:"red.500",children:"Erro ao carregar despesas."})}):e.jsx(Ne,{children:e.jsxs(Le,{variant:"striped",children:[e.jsx(Ie,{children:e.jsxs(se,{children:[e.jsx(N,{children:"Próximo Vencimento"}),e.jsx(N,{children:"Parcela"}),e.jsx(N,{children:"Descrição"}),e.jsx(N,{children:"Categoria"}),e.jsx(N,{isNumeric:!0,children:"Valor da Parcela"}),e.jsx(N,{isNumeric:!0,children:"Saldo Restante"}),e.jsx(N,{children:"Status"}),e.jsx(N,{children:"Ações"})]})}),e.jsx(Be,{children:M.map(P=>{if("proximaParcela"in P){const h=P;return e.jsxs(se,{children:[e.jsx(z,{children:er(h.proximaParcela.data_vencimento)}),e.jsx(z,{children:e.jsx(Fe,{colorScheme:"blue",children:`${h.proximaParcela.numero_parcela}/${h.totalParcelas}`})}),e.jsx(z,{children:h.descricaoBase}),e.jsx(z,{children:h.categoria||"---"}),e.jsx(z,{isNumeric:!0,color:"red.500",fontWeight:"bold",children:h.proximaParcela.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx(z,{isNumeric:!0,children:h.saldoRestante.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx(z,{children:e.jsx(ne,{label:h.proximaParcela.pago?"Pago":"Pendente",children:e.jsx(Fe,{colorScheme:h.proximaParcela.pago?"green":"orange",children:h.proximaParcela.pago?"Pago":"Pendente"})})}),e.jsx(z,{children:e.jsxs(W,{children:[e.jsx(ne,{label:"Marcar como pago/pendente",children:e.jsx(K,{"aria-label":"Marcar como pago/pendente",icon:e.jsx(fr,{}),onClick:()=>he(h.proximaParcela)})}),e.jsx(ne,{label:"Editar parcelamento (indisponível)",children:e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),isDisabled:!0})}),e.jsx(ne,{label:"Excluir parcelas futuras",children:e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),colorScheme:"red",onClick:()=>X(h)})})]})})]},h.parcela_id)}else{const h=P;return e.jsxs(se,{children:[e.jsx(z,{children:er(h.data_vencimento)}),e.jsx(z,{children:h.recorrente?e.jsx(Fe,{colorScheme:"purple",children:"Assinatura"}):"Única"}),e.jsx(z,{children:h.descricao}),e.jsx(z,{children:h.categoria||"---"}),e.jsx(z,{isNumeric:!0,color:"red.500",fontWeight:"bold",children:h.valor.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}),e.jsx(z,{isNumeric:!0,children:h.recorrente?"N/A":"---"}),e.jsx(z,{children:e.jsx(ne,{label:h.pago?`Pago em ${er(h.data_pagamento)}`:"Pendente",children:e.jsx(Fe,{colorScheme:h.pago?"green":"orange",children:h.pago?"Pago":"Pendente"})})}),e.jsx(z,{children:e.jsxs(W,{children:[e.jsx(ne,{label:"Marcar como pago/pendente",children:e.jsx(K,{"aria-label":"Marcar como pago/pendente",icon:e.jsx(fr,{}),onClick:()=>he(h)})}),e.jsx(ne,{label:"Editar despesa",children:e.jsx(K,{"aria-label":"Editar",icon:e.jsx(Pe,{}),onClick:()=>ce(h)})}),e.jsx(ne,{label:"Excluir despesa",children:e.jsx(K,{"aria-label":"Excluir",icon:e.jsx(Re,{}),colorScheme:"red",onClick:()=>X(h)})})]})})]},h.id)}})})]})}),e.jsx(jo,{isOpen:t,onClose:c,despesa:S,onSave:ue,isLoading:$.isPending,portalContainerRef:B}),e.jsx(po,{isOpen:x,onClose:p,onConfirm:fe,isLoading:te.isPending}),e.jsxs(ms,{isOpen:u,leastDestructiveRef:F,onClose:i,isCentered:!0,children:[e.jsx(me,{}),e.jsxs(js,{children:[e.jsx(je,{fontSize:"lg",fontWeight:"bold",children:"Confirmar Exclusão"}),e.jsxs(pe,{children:["Tem certeza que deseja excluir ","proximaParcela"in(D||{})?`a despesa "${D.descricaoBase}" e todas as suas parcelas futuras`:`a despesa "${D==null?void 0:D.descricao}"`,"? Esta ação não pode ser desfeita."]}),e.jsxs(ye,{children:[e.jsx(k,{ref:F,onClick:i,children:"Cancelar"}),e.jsx(k,{colorScheme:"red",onClick:le,ml:3,isLoading:H.isPending,children:"Sim, Excluir"})]})]})]})]})},on=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),Pr=["#3182CE","#DD6B20","#38A169","#D53F8C","#805AD5","#E53E3E","#D69E2E","#319795","#5A67D8","#B7791F"],fo=s=>{const{payload:r}=s,n=j("gray.600","gray.400");return e.jsx(ae,{spacing:2,align:"start",mt:4,children:r.map((a,t)=>e.jsxs(W,{spacing:3,w:"full",children:[e.jsx(C,{w:"12px",h:"12px",bg:a.color,borderRadius:"sm"}),e.jsx(o,{fontSize:"sm",color:n,isTruncated:!0,maxW:"150px",children:a.value}),e.jsxs(o,{fontSize:"sm",fontWeight:"bold",color:n,children:["(",on(a.payload.value),")"]})]},`item-${t}`))})},bo=({data:s,isLoading:r,isError:n})=>{const a=j("white","gray.700"),t=j("gray.200","gray.600"),l=j("white","gray.700"),c=j("gray.200","gray.600");return r?e.jsx(O,{h:"350px",children:e.jsx(ge,{size:"xl"})}):n?e.jsx(O,{h:"350px",children:e.jsx(o,{color:"red.500",children:"Erro ao carregar dados do gráfico."})}):!s||s.length===0?e.jsxs(C,{p:5,borderWidth:1,borderRadius:"md",bg:l,borderColor:c,h:"350px",children:[e.jsx(V,{size:"md",mb:4,children:"Despesas por Categoria"}),e.jsx(O,{h:"80%",children:e.jsx(o,{color:"gray.500",children:"Nenhuma despesa pessoal encontrada no período."})})]}):e.jsxs(C,{p:5,borderWidth:1,borderRadius:"md",bg:l,borderColor:c,h:"350px",children:[e.jsx(V,{size:"md",mb:4,children:"Despesas por Categoria"}),e.jsx(hs,{width:"100%",height:"90%",children:e.jsxs(Mr,{children:[e.jsx(xs,{formatter:(u,d)=>[on(u),d],contentStyle:{backgroundColor:a,borderColor:t,borderRadius:"md",boxShadow:"md"}}),e.jsx($r,{data:s,cx:"50%",cy:"50%",dataKey:"value",nameKey:"name",outerRadius:100,fill:"#8884d8",paddingAngle:s.length>1?2:0,labelLine:!1,label:({percent:u})=>`${(u*100).toFixed(0)}%`,children:s.map((u,d)=>e.jsx(Wr,{fill:Pr[d%Pr.length],stroke:a},`cell-${d}`))}),e.jsx(Is,{content:fo})]})})]})},yo=s=>typeof s!="number"||isNaN(s)?"R$ 0":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",notation:"compact",maximumFractionDigits:1}).format(s),vo=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),Co=({data:s,isLoading:r,isError:n})=>{const a=j("green.500","green.300"),t=j("red.500","red.300"),l=j("gray.600","gray.400"),c=j("gray.200","gray.700"),u=j("white","gray.800"),d=j("gray.300","gray.600"),i=j("white","gray.700"),x=j("gray.200","gray.600");return r?e.jsx(O,{h:"350px",children:e.jsx(ge,{size:"xl"})}):n?e.jsx(O,{h:"350px",children:e.jsx(o,{color:"red.500",children:"Erro ao carregar dados do gráfico."})}):!s||s.length===0?e.jsxs(C,{p:5,borderWidth:1,borderRadius:"md",bg:i,borderColor:x,h:"350px",children:[e.jsx(V,{size:"md",mb:4,children:"Balanço Mensal (Receitas x Despesas)"}),e.jsx(O,{h:"80%",children:e.jsx(o,{color:"gray.500",children:"Nenhum dado financeiro encontrado no período."})})]}):e.jsxs(C,{p:5,borderWidth:1,borderRadius:"md",bg:i,borderColor:x,h:"350px",children:[e.jsx(V,{size:"md",mb:4,children:"Balanço Mensal (Receitas x Despesas)"}),e.jsx(hs,{width:"100%",height:"90%",children:e.jsxs(Ts,{data:s,margin:{top:5,right:20,left:20,bottom:5},children:[e.jsx(Fs,{stroke:c,strokeDasharray:"3 3",vertical:!1}),e.jsx(Ns,{dataKey:"name",stroke:l,fontSize:12,tick:{fill:l}}),e.jsx(Ls,{stroke:l,fontSize:12,tick:{fill:l},tickFormatter:yo,width:80}),e.jsx(xs,{cursor:{fill:j("#00000010","#ffffff10")},formatter:f=>vo(f),contentStyle:{backgroundColor:u,borderColor:d,borderRadius:"md",boxShadow:"lg"}}),e.jsx(Is,{wrapperStyle:{color:l,paddingTop:"10px"}}),e.jsx(cs,{dataKey:"receitas",fill:a,name:"Receitas",radius:[4,4,0,0]}),e.jsx(cs,{dataKey:"despesas",fill:t,name:"Despesas",radius:[4,4,0,0]})]})})]})},So=(s,r)=>s.length<=r?s:`${s.substring(0,r)}...`,Er=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",notation:"compact",maximumFractionDigits:1}).format(s),wo=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),Do=({data:s,isLoading:r,isError:n})=>{const a=j("orange.400","orange.300"),t=j("gray.600","gray.400"),l=j("gray.700","gray.200"),c=j("gray.200","gray.700"),u=j("white","gray.800"),d=j("gray.300","gray.600"),i=j("white","gray.700"),x=j("gray.200","gray.600");if(r)return e.jsx(O,{h:"350px",children:e.jsx(ge,{size:"xl"})});if(n)return e.jsx(O,{h:"350px",children:e.jsx(o,{color:"red.500",children:"Erro ao carregar dados do gráfico."})});if(!s||s.length===0)return e.jsxs(C,{p:5,borderWidth:1,borderRadius:"md",bg:i,borderColor:x,h:"350px",children:[e.jsx(V,{size:"md",mb:4,children:"Top 5 Despesas Individuais"}),e.jsx(O,{h:"80%",children:e.jsx(o,{color:"gray.500",children:"Nenhuma despesa para exibir no ranking."})})]});const f=[...s].reverse();return e.jsxs(C,{p:5,borderWidth:1,borderRadius:"md",bg:i,borderColor:x,h:"350px",children:[e.jsx(V,{size:"md",mb:4,children:"Top 5 Despesas Individuais"}),e.jsx(hs,{width:"100%",height:"90%",children:e.jsxs(Ts,{data:f,layout:"vertical",margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(Fs,{stroke:c,strokeDasharray:"3 3",horizontal:!1}),e.jsx(Ns,{type:"number",stroke:t,fontSize:12,tick:{fill:t},tickFormatter:Er}),e.jsx(Ls,{type:"category",dataKey:"descricao",stroke:t,fontSize:12,tick:{fill:t},tickFormatter:p=>So(p,25),width:150}),e.jsx(xs,{cursor:{fill:j("#00000010","#ffffff10")},formatter:p=>[wo(p),"Valor"],contentStyle:{backgroundColor:u,borderColor:d,borderRadius:"md",boxShadow:"lg"}}),e.jsx(cs,{dataKey:"valor",fill:a,name:"Valor",radius:[0,4,4,0],children:e.jsx(Vr,{dataKey:"valor",position:"right",formatter:Er,fill:l,fontSize:12,fontWeight:"bold"})})]})})]})},Ro=({isOpen:s,onClose:r,onConfirm:n,isLoading:a})=>{const[t,l]=m.useState(Ye(new Date,"yyyy-MM-dd"));return e.jsxs(ys,{isOpen:s,onClose:r,isCentered:!0,children:[e.jsx(me,{}),e.jsxs(vs,{children:[e.jsx(je,{children:"Confirmar Data do Pagamento"}),e.jsx(Te,{}),e.jsx(pe,{children:e.jsxs(q,{children:[e.jsx(A,{children:"Data em que o pagamento foi realizado"}),e.jsx(T,{type:"date",value:t,onChange:c=>l(c.target.value)})]})}),e.jsxs(ye,{children:[e.jsx(k,{variant:"ghost",mr:3,onClick:r,children:"Cancelar"}),e.jsx(k,{colorScheme:"green",onClick:()=>n(t),isLoading:a,children:"Confirmar Pagamento"})]})]})]})},Po=()=>{const s=ze(),r=Se(),{isOpen:n,onOpen:a,onClose:t}=xe(),[l,c]=m.useState(null),u=j("orange.50","orange.900"),d=j("orange.400","orange.500"),i=j("red.100","red.800"),x=j("whiteAlpha.800","whiteAlpha.100"),{data:f,isLoading:p,isError:S}=re({queryKey:["despesasPessoaisPendentes"],queryFn:mo}),R=ee({mutationFn:F=>an(F.id,!0,F.dataPagamento),onSuccess:()=>{s.invalidateQueries({queryKey:["despesasPessoaisPendentes"]}),s.invalidateQueries({queryKey:["despesasPessoais"]}),s.invalidateQueries({queryKey:["dashboardConsolidado"]}),s.invalidateQueries({queryKey:["analiseFinanceira"]}),r({title:"Pagamento registrado com sucesso!",status:"success"}),t()},onError:F=>{var B,Q;r({title:"Erro ao registrar pagamento",description:((Q=(B=F.response)==null?void 0:B.data)==null?void 0:Q.error)||F.message,status:"error"})}}),D=F=>{c(F),a()},b=F=>{l&&R.mutate({id:l.id,dataPagamento:F})},L=F=>{if(!F)return"Data inválida";const B=Ze(F);return fs(B)?B.toLocaleDateString("pt-BR",{timeZone:"UTC"}):"Data inválida"},y=F=>{if(!F)return!1;const B=Us(new Date),Q=Kr(B,5),U=Us(Ze(F));return fs(U)?Ur(U,Q):!1};return e.jsxs(C,{p:5,borderWidth:2,borderRadius:8,boxShadow:"md",h:"100%",bg:u,borderColor:d,children:[e.jsx(V,{size:"md",mb:4,children:"Despesas Pessoais Pendentes"}),p&&e.jsx(ge,{}),S&&e.jsx(o,{color:"red.500",children:"Erro ao carregar despesas pendentes."}),!p&&!S&&e.jsx(ae,{spacing:3,align:"stretch",overflowY:"auto",maxHeight:"300px",children:f&&f.length>0?f.map(F=>e.jsxs(C,{p:3,bg:y(F.data_vencimento)?i:x,borderRadius:"md",boxShadow:"sm",children:[e.jsxs(I,{justify:"space-between",align:{base:"flex-start",md:"center"},direction:{base:"column",md:"row"},children:[e.jsxs(ae,{align:"start",spacing:0,mb:{base:2,md:0},children:[e.jsx(o,{fontWeight:"bold",noOfLines:1,children:F.descricao}),e.jsxs(o,{fontSize:"sm",children:["Vence em: ",L(F.data_vencimento)]})]}),e.jsx(o,{fontWeight:"bold",color:"red.500",fontSize:"lg",mb:{base:2,md:0},children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(F.valor)}),e.jsx(k,{display:{base:"none",md:"inline-flex"},colorScheme:"green",size:"sm",onClick:()=>D(F),children:"Pagar"})]}),e.jsx(Ue,{my:2,display:{base:"block",md:"none"}}),e.jsx(k,{display:{base:"inline-flex",md:"none"},colorScheme:"green",size:"sm",w:"full",onClick:()=>D(F),children:"Pagar"})]},F.id)):e.jsx(o,{color:"gray.500",textAlign:"center",pt:8,children:"Nenhuma despesa pessoal pendente."})}),e.jsx(Ro,{isOpen:n,onClose:t,onConfirm:b,isLoading:R.isPending})]})},Eo=()=>{const s=new Date,r=Se(),[n,a]=m.useState(Ye(As(s),"yyyy-MM-dd")),[t,l]=m.useState(Ye(qs(s),"yyyy-MM-dd")),[c,u]=m.useState(0),[d,i]=m.useState(""),x=us(d,500),f=(w,$)=>{a(Ye(w,"yyyy-MM-dd")),l(Ye($,"yyyy-MM-dd"))},{data:p,isLoading:S,isError:R}=re({queryKey:["analiseFinanceira",{startDate:n,endDate:t}],queryFn:()=>Ya({startDate:n,endDate:t}),enabled:!!n&&!!t}),D=w=>{const $=URL.createObjectURL(w);window.open($,"_blank"),r({title:"Relatório Gerado",description:"O PDF foi aberto em uma nova aba.",status:"success"})},b=w=>{var $,H;r({title:"Erro ao gerar PDF",description:((H=($=w.response)==null?void 0:$.data)==null?void 0:H.error)||"Não foi possível gerar o relatório.",status:"error"})},L=ee({mutationFn:Xa,onSuccess:D,onError:b}),y=ee({mutationFn:Ja,onSuccess:D,onError:b}),F=()=>{r({title:"Gerando relatório...",status:"info",duration:1500});const w={startDate:n,endDate:t};c===1?y.mutate(w):c===2&&L.mutate(w)},B=L.isPending||y.isPending,Q=c===1||c===2,U={fontWeight:"semibold",px:{base:3,md:6},py:3,borderRadius:"md",transition:"all 0.2s ease-in-out"};return e.jsxs(C,{p:{base:4,md:8},children:[e.jsx(V,{as:"h1",mb:2,children:"Centro Financeiro"}),e.jsx(o,{color:"gray.500",mb:6,children:"Analise os dados consolidados do negócio e das suas finanças pessoais."}),e.jsxs(C,{p:4,borderWidth:1,borderRadius:"md",my:6,bg:j("gray.50","gray.700"),children:[e.jsx(V,{size:"md",mb:4,children:"Filtrar Período Global"}),e.jsxs(ns,{columns:{base:1,sm:2,md:4},spacing:2,mb:4,children:[e.jsx(k,{onClick:()=>f(As(s),qs(s)),children:"Este Mês"}),e.jsx(k,{onClick:()=>f(Qs(s,30),s),children:"Últimos 30 dias"}),e.jsx(k,{leftIcon:e.jsx(De,{as:Gr}),colorScheme:"teal",onClick:F,isLoading:B,isDisabled:!Q,loadingText:"Gerando...",children:"Exportar PDF"})]}),e.jsxs(I,{gap:4,align:"flex-end",direction:{base:"column",md:"row"},children:[e.jsxs(C,{flex:1,w:"full",children:[e.jsx(o,{fontSize:"sm",mb:1,children:"Data de Início"}),e.jsx(T,{type:"date",value:n,onChange:w=>a(w.target.value),bg:j("white","gray.800")})]}),e.jsxs(C,{flex:1,w:"full",children:[e.jsx(o,{fontSize:"sm",mb:1,children:"Data de Fim"}),e.jsx(T,{type:"date",value:t,onChange:w=>l(w.target.value),bg:j("white","gray.800")})]})]})]}),e.jsxs(lr,{variant:"unstyled",align:"center",onChange:w=>u(w),children:[e.jsxs(dr,{gap:3,children:[e.jsx(Ve,{...U,_selected:{color:"white",bg:"teal.400",boxShadow:"md"},_hover:{bg:j("teal.50","gray.600"),color:j("gray.800","white")},children:"Dashboard"}),e.jsx(Ve,{...U,_selected:{color:"white",bg:"green.400",boxShadow:"md"},_hover:{bg:j("green.50","green.800"),color:j("gray.800","white")},children:"Receitas Pessoais"}),e.jsx(Ve,{...U,_selected:{color:"white",bg:"red.400",boxShadow:"md"},_hover:{bg:j("red.50","red.800"),color:j("gray.800","white")},children:"Despesas Pessoais"})]}),e.jsxs(cr,{mt:5,children:[e.jsxs(Ke,{children:[e.jsx(eo,{filters:{startDate:n,endDate:t}}),e.jsx(C,{mt:8,children:e.jsx(Po,{})}),e.jsxs(ns,{columns:{base:1,lg:3},spacing:6,mt:8,children:[e.jsx(bo,{data:p==null?void 0:p.despesasPorCategoria,isLoading:S,isError:R}),e.jsx(Do,{data:p==null?void 0:p.top5Despesas,isLoading:S,isError:R}),e.jsx(Co,{data:p==null?void 0:p.balancoMensal,isLoading:S,isError:R})]})]}),e.jsxs(Ke,{children:[e.jsx(C,{mb:6,children:e.jsxs(Qe,{children:[e.jsx(ts,{pointerEvents:"none",children:e.jsx(as,{color:"gray.300"})}),e.jsx(T,{placeholder:"Buscar por descrição ou categoria...",value:d,onChange:w=>i(w.target.value)})]})}),e.jsx(io,{})]}),e.jsxs(Ke,{children:[e.jsx(C,{mb:6,children:e.jsxs(Qe,{children:[e.jsx(ts,{pointerEvents:"none",children:e.jsx(as,{color:"gray.300"})}),e.jsx(T,{placeholder:"Buscar por descrição ou categoria...",value:d,onChange:w=>i(w.target.value)})]})}),e.jsx(go,{filters:{startDate:n,endDate:t},termoBusca:x})]})]})]})]})},_o="http://localhost:3001/api",ur=ke.create({baseURL:_o});ur.interceptors.request.use(s=>{const r=localStorage.getItem("token");return r&&(s.headers.Authorization=`Bearer ${r}`),s},s=>Promise.reject(s));const qo=async()=>{var s,r;try{return(await ur.get("/empresa")).data}catch(n){throw new Error(((r=(s=n.response)==null?void 0:s.data)==null?void 0:r.error)||"Falha ao buscar os dados da empresa.")}},Ao=async s=>{var r,n;try{return(await ur.put("/empresa",s)).data}catch(a){throw new Error(((n=(r=a.response)==null?void 0:r.data)==null?void 0:n.error)||"Falha ao salvar os dados da empresa.")}},ko=()=>{var S;const s=Se(),r=ze(),{data:n,isLoading:a,isError:t,error:l}=re({queryKey:["empresaDados"],queryFn:qo}),{register:c,handleSubmit:u,reset:d,formState:{errors:i,isSubmitting:x}}=Oe();m.useEffect(()=>{n&&d(n)},[n,d]);const f=ee({mutationFn:Ao,onSuccess:()=>{r.invalidateQueries({queryKey:["empresaDados"]}),s({title:"Sucesso!",description:"Os dados da empresa foram atualizados.",status:"success",duration:5e3,isClosable:!0})},onError:R=>{s({title:"Erro ao salvar",description:R.message,status:"error",duration:5e3,isClosable:!0})}}),p=R=>{f.mutate(R)};return a?e.jsxs(C,{textAlign:"center",mt:10,children:[e.jsx(ge,{size:"xl"}),e.jsx(o,{mt:4,children:"Carregando dados da empresa..."})]}):t?e.jsxs(C,{textAlign:"center",mt:10,color:"red.500",children:[e.jsx(V,{size:"md",children:"Ocorreu um erro"}),e.jsx(o,{mt:2,children:l.message})]}):e.jsxs(C,{children:[e.jsx(V,{as:"h1",size:"xl",mb:8,children:"Dados da Empresa"}),e.jsx(C,{as:"form",onSubmit:u(p),p:8,borderWidth:1,borderRadius:"md",boxShadow:"lg",bg:"white",_dark:{bg:"gray.700"},children:e.jsxs(ae,{spacing:6,children:[e.jsxs(Mn,{templateColumns:{base:"1fr",md:"repeat(2, 1fr)"},gap:6,w:"100%",children:[e.jsx(ds,{colSpan:{base:1,md:2},children:e.jsxs(q,{isInvalid:!!i.nome_fantasia,isRequired:!0,children:[e.jsx(A,{htmlFor:"nome_fantasia",children:"Nome Fantasia"}),e.jsx(T,{id:"nome_fantasia",...c("nome_fantasia",{required:"Nome Fantasia é obrigatório"})}),e.jsx(Z,{children:(S=i.nome_fantasia)==null?void 0:S.message})]})}),e.jsx(ds,{children:e.jsxs(q,{isInvalid:!!i.razao_social,children:[e.jsx(A,{htmlFor:"razao_social",children:"Razão Social"}),e.jsx(T,{id:"razao_social",...c("razao_social")})]})}),e.jsx(ds,{children:e.jsxs(q,{isInvalid:!!i.cnpj,children:[e.jsx(A,{htmlFor:"cnpj",children:"CNPJ"}),e.jsx(T,{id:"cnpj",...c("cnpj")})]})}),e.jsx(ds,{children:e.jsxs(q,{isInvalid:!!i.inscricao_estadual,children:[e.jsx(A,{htmlFor:"inscricao_estadual",children:"Inscrição Estadual"}),e.jsx(T,{id:"inscricao_estadual",...c("inscricao_estadual")})]})}),e.jsx(ds,{children:e.jsxs(q,{isInvalid:!!i.telefone,children:[e.jsx(A,{htmlFor:"telefone",children:"Telefone"}),e.jsx(T,{id:"telefone",...c("telefone")})]})}),e.jsx(ds,{colSpan:{base:1,md:2},children:e.jsxs(q,{isInvalid:!!i.email,children:[e.jsx(A,{htmlFor:"email",children:"Email de Contato"}),e.jsx(T,{id:"email",type:"email",...c("email")})]})}),e.jsx(ds,{colSpan:{base:1,md:2},children:e.jsxs(q,{isInvalid:!!i.endereco_completo,children:[e.jsx(A,{htmlFor:"endereco_completo",children:"Endereço Completo"}),e.jsx(ir,{id:"endereco_completo",...c("endereco_completo")})]})})]}),e.jsx(k,{type:"submit",colorScheme:"blue",isLoading:x||f.isPending,loadingText:"Salvando...",size:"lg",w:"full",mt:4,children:"Salvar Alterações"})]})})]})},zo=()=>{const[s,r]=m.useState(!0),n=ve({base:!0,md:!1}),a=n?0:s?"240px":"72px";return e.jsxs(I,{h:"100vh",bg:"gray.50",_dark:{bg:"gray.900"},children:[!n&&e.jsx(Jn,{isCollapsed:!s}),e.jsxs(I,{direction:"column",as:"main",flex:"1",ml:{base:0,md:a},pb:{base:"60px",md:0},transition:"margin-left 0.2s ease-in-out",overflowY:"auto",children:[e.jsx(C,{position:"sticky",top:"0",zIndex:"docked",bg:"chakra-body-bg",boxShadow:"sm",children:e.jsx(Zn,{onToggleSidebar:()=>r(!s),isSidebarOpen:s})}),e.jsx(C,{p:{base:4,md:8},children:e.jsx(tr,{})})]}),n&&e.jsx(Xn,{})]})};function To(){return e.jsxs($n,{children:[e.jsx(we,{path:"/login",element:e.jsx(at,{})}),e.jsx(we,{path:"/solicitar-acesso",element:e.jsx(Qa,{})}),e.jsx(we,{element:e.jsx(et,{}),children:e.jsxs(we,{element:e.jsx(zo,{}),children:[e.jsx(we,{path:"/movimentacoes",element:e.jsx(sa,{})}),e.jsx(we,{path:"/clientes",element:e.jsx(aa,{})}),e.jsx(we,{path:"/produtos",element:e.jsx(la,{})}),e.jsxs(we,{element:e.jsx(st,{}),children:[e.jsx(we,{path:"/",element:e.jsx(vr,{})}),e.jsx(we,{path:"/dashboard",element:e.jsx(vr,{})}),e.jsx(we,{path:"/relatorios",element:e.jsx(Ua,{})}),e.jsx(we,{path:"/fornecedores",element:e.jsx(ua,{})}),e.jsx(we,{path:"/utilizadores",element:e.jsx(ma,{})}),e.jsx(we,{path:"/financas",element:e.jsx(Eo,{})}),e.jsx(we,{path:"/empresa",element:e.jsx(ko,{})})]})]})}),e.jsx(we,{path:"*",element:e.jsx(Ga,{})})]})}const Fo=new Wn,ln=document.getElementById("root");if(!ln)throw new Error("Failed to find the root element");Vn.createRoot(ln).render(e.jsx(Kn.StrictMode,{children:e.jsx(Un,{client:Fo,children:e.jsx(Qn,{children:e.jsx(Gn,{children:e.jsx(Yn,{children:e.jsx(To,{})})})})})}));
